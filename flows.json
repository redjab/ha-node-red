[
    {
        "id": "d9fe96b5.8701c8",
        "type": "tab",
        "label": "Simple automations",
        "disabled": false,
        "info": ""
    },
    {
        "id": "b88bc227.1b73f",
        "type": "tab",
        "label": "Mobile action listeners",
        "disabled": false,
        "info": ""
    },
    {
        "id": "9889ef6.6e2771",
        "type": "tab",
        "label": "Event listeners",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e2c67c6c.68265",
        "type": "tab",
        "label": "Reminders",
        "disabled": false,
        "info": ""
    },
    {
        "id": "955dbfd5.2d3eb",
        "type": "tab",
        "label": "Water plants",
        "disabled": false,
        "info": ""
    },
    {
        "id": "7593ec4d.460434",
        "type": "tab",
        "label": "Garage door",
        "disabled": false,
        "info": ""
    },
    {
        "id": "670bc302.cb732c",
        "type": "subflow",
        "name": "Notify HA apps",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 100,
                "wires": [
                    {
                        "id": "5934701d.5e303"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 660,
                "y": 160,
                "wires": [
                    {
                        "id": "5a2b4568.2d2c5c",
                        "port": 0
                    }
                ]
            },
            {
                "x": 660,
                "y": 100,
                "wires": [
                    {
                        "id": "8495431f.f4f32",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "cfb8073e.876f88",
        "type": "subflow",
        "name": "Update light state",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 140,
                "wires": [
                    {
                        "id": "b62cc54a.e92368"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 880,
                "y": 340,
                "wires": [
                    {
                        "id": "bf7a5591.a95cc8",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "entity_id",
                "type": "str",
                "value": ""
            },
            {
                "name": "interval",
                "type": "num",
                "value": "50"
            },
            {
                "name": "delay",
                "type": "num",
                "value": "0"
            }
        ],
        "color": "#DDAA99"
    },
    {
        "id": "3efaa203.1c443e",
        "type": "server",
        "name": "Home Assistant",
        "legacy": false,
        "addon": false,
        "rejectUnauthorizedCerts": false,
        "ha_boolean": "y|yes|true|on|home|open",
        "connectionDelay": true,
        "cacheJson": false
    },
    {
        "id": "fea39eb8.12411",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "Notifiy about rain",
        "info": "",
        "x": 120,
        "y": 60,
        "wires": []
    },
    {
        "id": "a4a51bd5.cbf1a8",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "d": true,
        "name": "If it's rainy",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "weather.kpvu_hourly",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "rainy",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 100,
        "wires": [
            [
                "27015fcf.eaa1e"
            ],
            []
        ]
    },
    {
        "id": "cfbda5ba.dea498",
        "type": "inject",
        "z": "d9fe96b5.8701c8",
        "name": "3 AM everyday ",
        "repeat": "",
        "crontab": "00 03 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 340,
        "wires": [
            [
                "c499881d.445368"
            ]
        ]
    },
    {
        "id": "795b7b3e.e3f064",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Start vacuum",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "vacuum",
        "service": "start",
        "entityId": "vacuum.roborock",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 550,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "c499881d.445368",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Set max fan speed",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "vacuum",
        "service": "set_fan_speed",
        "entityId": "vacuum.roborock",
        "data": "{\"fan_speed\":\"max\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 350,
        "y": 340,
        "wires": [
            [
                "795b7b3e.e3f064"
            ]
        ]
    },
    {
        "id": "f2f183f9.0381c",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "Run vacumm every morning",
        "info": "",
        "x": 160,
        "y": 300,
        "wires": []
    },
    {
        "id": "3e215458.36073c",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Vacuum error",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "vacuum.roborock",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "error",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 110,
        "y": 420,
        "wires": [
            [
                "d46beef9.4f088"
            ],
            []
        ]
    },
    {
        "id": "d5b4c56e.e9c588",
        "type": "trigger-state",
        "z": "d9fe96b5.8701c8",
        "d": true,
        "name": "Rain stopped",
        "server": "3efaa203.1c443e",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityid": "weather.kpvu_hourly",
        "entityidfiltertype": "exact",
        "debugenabled": false,
        "constraints": [
            {
                "id": "p7a1tr6c15",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is_not",
                "comparatorValueDatatype": "str",
                "comparatorValue": "rainy"
            },
            {
                "id": "vrfqo44y8r",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "previous_state",
                "propertyValue": "old_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "rainy"
            }
        ],
        "constraintsmustmatch": "all",
        "outputs": 2,
        "customoutputs": [],
        "outputinitially": false,
        "state_type": "str",
        "x": 110,
        "y": 180,
        "wires": [
            [
                "228dd1fe.a262ce"
            ],
            []
        ]
    },
    {
        "id": "442ab0e0.9b202",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 480,
        "y": 180,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "f5b4874.c820978",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 480,
        "y": 100,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "35e31cc.f48d0e4",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 480,
        "y": 420,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "7c8c59df.9fc818",
        "type": "comment",
        "z": "670bc302.cb732c",
        "name": "Notify HA apps & logs to HA",
        "info": "",
        "x": 160,
        "y": 40,
        "wires": []
    },
    {
        "id": "623970e8.0aa2f",
        "type": "server-events",
        "z": "b88bc227.1b73f",
        "name": "",
        "server": "3efaa203.1c443e",
        "event_type": "mobile_app_notification_action",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "x": 190,
        "y": 60,
        "wires": [
            [
                "3c2f703.3aecf9"
            ]
        ]
    },
    {
        "id": "3c2f703.3aecf9",
        "type": "switch",
        "z": "b88bc227.1b73f",
        "name": "",
        "property": "payload.event.action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "notification.vacuum.roborock.find",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "notification.garage.open",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "notification.garage.close",
                "vt": "str"
            },
            {
                "t": "regex",
                "v": "notification\\.plant\\.input_boolean\\..*\\.watered",
                "vt": "str",
                "case": true
            },
            {
                "t": "eq",
                "v": "notification.washing_machine.open",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "notification.humidifier.fill",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 6,
        "x": 430,
        "y": 180,
        "wires": [
            [
                "752d962a.3714c8"
            ],
            [
                "586abfa1.56235"
            ],
            [
                "e38a2c4c.2afee"
            ],
            [],
            [
                "72da23c9.44b4bc"
            ],
            [
                "da01d7df.4fbd18"
            ]
        ]
    },
    {
        "id": "752d962a.3714c8",
        "type": "api-call-service",
        "z": "b88bc227.1b73f",
        "name": "Find robot",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "vacuum",
        "service": "locate",
        "entityId": "vacuum.roborock",
        "data": "{ \"entity_id\": \"vacuum.roborock\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 620,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "3ea02219.60e39e",
        "type": "inject",
        "z": "e2c67c6c.68265",
        "name": "8:30 AM Thursday",
        "props": [],
        "repeat": "",
        "crontab": "30 08 * * 4",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "e6e88d4e.59b0e"
            ]
        ]
    },
    {
        "id": "5cad1124.07924",
        "type": "subflow:670bc302.cb732c",
        "z": "e2c67c6c.68265",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 580,
        "y": 100,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "815f4d5.29d7fb",
        "type": "comment",
        "z": "e2c67c6c.68265",
        "name": "Reminder to take trash in/out",
        "info": "",
        "x": 160,
        "y": 60,
        "wires": []
    },
    {
        "id": "42be322c.cb3ccc",
        "type": "inject",
        "z": "e2c67c6c.68265",
        "name": "4 PM Thursday",
        "props": [],
        "repeat": "",
        "crontab": "00 16 * * 4",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 120,
        "y": 160,
        "wires": [
            [
                "e3a8c10d.9e079"
            ]
        ]
    },
    {
        "id": "a73fc1db.8105",
        "type": "subflow:670bc302.cb732c",
        "z": "e2c67c6c.68265",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 580,
        "y": 160,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "586abfa1.56235",
        "type": "api-call-service",
        "z": "b88bc227.1b73f",
        "name": "Open garage",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "cover",
        "service": "open_cover",
        "entityId": "cover.garage_door",
        "data": "{ \"entity_id\": \"cover.garage_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 630,
        "y": 140,
        "wires": [
            [
                "be42f3e1.aa2a1",
                "499f21fb.529f2"
            ]
        ]
    },
    {
        "id": "e38a2c4c.2afee",
        "type": "api-call-service",
        "z": "b88bc227.1b73f",
        "name": "Close garage",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "cover",
        "service": "close_cover",
        "entityId": "cover.garage_door",
        "data": "{ \"entity_id\": \"cover.garage_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 630,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "8d434d29.85a88",
        "type": "api-call-service",
        "z": "9889ef6.6e2771",
        "name": "Set noctis theme",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "frontend",
        "service": "set_theme",
        "entityId": "",
        "data": "{\"name\":\"noctis\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 310,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "ddad8919.724b68",
        "type": "server-events",
        "z": "9889ef6.6e2771",
        "name": "",
        "server": "3efaa203.1c443e",
        "event_type": "call_service",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "waitForRunning": true,
        "x": 130,
        "y": 120,
        "wires": [
            [
                "901be019.50f94"
            ]
        ]
    },
    {
        "id": "c10ad374.4a6cd",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "USPS Delivered",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.mail_usps_delivered",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 800,
        "wires": [
            [
                "b60867ef.dba148"
            ],
            []
        ]
    },
    {
        "id": "4257a54c.c5696c",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "UPS Delivered",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.mail_ups_delivered",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 860,
        "wires": [
            [
                "230417ea.7965a8"
            ],
            []
        ]
    },
    {
        "id": "7a0839f3.3014a8",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Fedex Delivered",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.mail_fedex_delivered",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 920,
        "wires": [
            [
                "b43bd907.3ae248"
            ],
            []
        ]
    },
    {
        "id": "601b8ab1.27f8e4",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 720,
        "y": 900,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "b60867ef.dba148",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{ \"count\": $$.data.new_state.state - $$.data.old_state.state, \"carrier\": \"USPS\" }",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 800,
        "wires": [
            [
                "ec5c4d8e.e2185"
            ]
        ]
    },
    {
        "id": "230417ea.7965a8",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{ \"count\": $$.data.new_state.state - $$.data.old_state.state, \"carrier\": \"UPS\" }",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 860,
        "wires": [
            [
                "ec5c4d8e.e2185"
            ]
        ]
    },
    {
        "id": "b43bd907.3ae248",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{ \"count\": $$.data.new_state.state - $$.data.old_state.state, \"carrier\": \"Fedex\" }",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 920,
        "wires": [
            [
                "ec5c4d8e.e2185"
            ]
        ]
    },
    {
        "id": "257351ca.c2b3be",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "New package(s) delivered",
        "info": "",
        "x": 150,
        "y": 760,
        "wires": []
    },
    {
        "id": "68cc1ff9.b3b1e",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "USPS Mail Coming Today",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.mail_usps_mail",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 1040,
        "wires": [
            [
                "34239bb9.636774"
            ],
            []
        ]
    },
    {
        "id": "15739cae.559ee3",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 560,
        "y": 1040,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "e2f0473b.d22fe8",
        "type": "inject",
        "z": "9889ef6.6e2771",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 60,
        "wires": [
            [
                "8d434d29.85a88"
            ]
        ]
    },
    {
        "id": "7434d2eb.da0c3c",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Amazon Delivered",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.mail_amazon_packages_delivered",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 980,
        "wires": [
            [
                "91d7fb52.d922d8"
            ],
            []
        ]
    },
    {
        "id": "91d7fb52.d922d8",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{ \"count\": $$.data.new_state.state - $$.data.old_state.state, \"carrier\": \"Amazon\" }",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 980,
        "wires": [
            [
                "ec5c4d8e.e2185"
            ]
        ]
    },
    {
        "id": "5a2b4568.2d2c5c",
        "type": "api-call-service",
        "z": "670bc302.cb732c",
        "name": "Notify HA apps",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": true,
        "service_domain": "notify",
        "service": "all_phone_app",
        "entityId": "",
        "data": "$$.payload.notification",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 340,
        "y": 100,
        "wires": [
            [
                "8495431f.f4f32"
            ]
        ]
    },
    {
        "id": "8495431f.f4f32",
        "type": "api-call-service",
        "z": "670bc302.cb732c",
        "name": "Log",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "$$.payload.log",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": true,
        "x": 550,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "ec5c4d8e.e2185",
        "type": "function",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "func": "return {\n    \"payload\": {\n        \"notification\":\n        {\n            \"title\":\"Mails & Packages\",\n            \"message\":`ðŸ“¦ ${msg.payload.count} New package(s) from ${msg.payload.carrier} delivered`,\n            \"data\": {\n                \"tag\":\"package.delivered\",\n                \"priority\":\"high\",\n                \"ttl\":0\n            }\n        },\n        \"log\": {\n            \"name\": msg.payload.carrier,\n            \"entity_id\": msg.data.entity_id,\n            \"message\":\"notified delivered\",\n            \"domain\":\"notify\"\n        }\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 540,
        "y": 900,
        "wires": [
            [
                "601b8ab1.27f8e4"
            ]
        ]
    },
    {
        "id": "228dd1fe.a262ce",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Weather\",\"message\":\"â›… It stopped raining\",\"data\":{\"tag\":\"weather.rain.stop\",\"priority\":\"normal\",\"ttl\":0}},\"log\":{\"name\":\"Weather (Node Red)\",\"entity_id\":\"weather.kpvu_hourly\",\"message\":\"notified rain stopped\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 180,
        "wires": [
            [
                "442ab0e0.9b202"
            ]
        ]
    },
    {
        "id": "27015fcf.eaa1e",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Weather\",\"message\":\"ðŸŒ§ï¸ It might be raining\",\"data\":{\"tag\":\"weather.rain.start\",\"priority\":\"high\",\"ttl\":0}},\"log\":{\"name\":\"Weather (Node Red)\",\"entity_id\":\"weather.kpvu_hourly\",\"message\":\"notified rain\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 100,
        "wires": [
            [
                "f5b4874.c820978"
            ]
        ]
    },
    {
        "id": "d46beef9.4f088",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Roborock Vacuum\",\"message\":\"ðŸ§¹ï¸ âš ï¸ Vacuum in error state\",\"data\":{\"tag\":\"vacuum.error\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Find robot\",\"action\":\"notification.vacuum.roborock.find\"}]}},\"log\":{\"name\":\"Roborock (Node Red)\",\"entity_id\":\"vacuum.roborock\",\"message\":\"notified error\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 420,
        "wires": [
            [
                "35e31cc.f48d0e4"
            ]
        ]
    },
    {
        "id": "e6e88d4e.59b0e",
        "type": "change",
        "z": "e2c67c6c.68265",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Trash day\",\"message\":\"ðŸ—‘Don't forget to take the trash out!\",\"data\":{\"tag\":\"trash.reminder\",\"priority\":\"high\",\"ttl\":0}},\"log\":{\"name\":\"Trash day reminder\",\"message\":\"reminded to take trash out\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 100,
        "wires": [
            [
                "5cad1124.07924"
            ]
        ]
    },
    {
        "id": "e3a8c10d.9e079",
        "type": "change",
        "z": "e2c67c6c.68265",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"After trash day\",\"message\":\"ðŸ—‘Don't forget to take the trash IN!\",\"data\":{\"tag\":\"trash.reminder\",\"priority\":\"high\",\"ttl\":0}},\"log\":{\"name\":\"Trash day reminder\",\"message\":\"reminded to take trash IN\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 160,
        "wires": [
            [
                "a73fc1db.8105"
            ]
        ]
    },
    {
        "id": "38ffe2f9.d41c8e",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Living Room Light On",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "light.living_room",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 1180,
        "wires": [
            [
                "850099cd.2a80e8"
            ],
            []
        ]
    },
    {
        "id": "850099cd.2a80e8",
        "type": "api-current-state",
        "z": "d9fe96b5.8701c8",
        "name": "TV On",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "media_player.living_room_tv",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 330,
        "y": 1200,
        "wires": [
            [
                "f33e2978.d2d158"
            ],
            []
        ]
    },
    {
        "id": "557be09b.cd1a5",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "TV On",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "media_player.living_room_tv",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 1300,
        "wires": [
            [
                "f33e2978.d2d158"
            ],
            []
        ]
    },
    {
        "id": "f33e2978.d2d158",
        "type": "api-current-state",
        "z": "d9fe96b5.8701c8",
        "name": "After dark? (-1 hour offset)",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.after_dark_offset",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 500,
        "y": 1240,
        "wires": [
            [
                "36b728b3.a353a8"
            ],
            []
        ]
    },
    {
        "id": "d3b259b7.fccef8",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Set brightness",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "light.living_room",
        "data": "$$.payload ? {\t   \"entity_id\":\"light.living_room\",\t   \"brightness_pct\": $$.payload\t} : { \"entity_id\":\"light.living_room\" }",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 640,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "8bf21445.4b9538",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "Set dimmer according to sun position & TV state",
        "info": "",
        "x": 220,
        "y": 1120,
        "wires": []
    },
    {
        "id": "36b728b3.a353a8",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "Bightness 65",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "65",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 1300,
        "wires": [
            [
                "d3b259b7.fccef8"
            ]
        ]
    },
    {
        "id": "7c62d47d.ecb98c",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "TV Off",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "media_player.living_room_tv",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 1380,
        "wires": [
            [
                "75fc1d63.768cc4"
            ],
            []
        ]
    },
    {
        "id": "75fc1d63.768cc4",
        "type": "api-current-state",
        "z": "d9fe96b5.8701c8",
        "name": "Living Room Light On",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.living_room",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 260,
        "y": 1380,
        "wires": [
            [
                "583192e7.17a02c"
            ],
            []
        ]
    },
    {
        "id": "583192e7.17a02c",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "Brightness 100",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "80",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 1380,
        "wires": [
            [
                "d3b259b7.fccef8"
            ]
        ]
    },
    {
        "id": "e80845f5.8c8a68",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "After dark (-1 hour offset)",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.after_dark_offset",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 1240,
        "wires": [
            [
                "850099cd.2a80e8"
            ],
            []
        ]
    },
    {
        "id": "38735664.29c46a",
        "type": "server-state-changed",
        "z": "9889ef6.6e2771",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "switch.cabinet_light",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 240,
        "y": 320,
        "wires": [
            [
                "6fc54a8c.45b3d4"
            ]
        ]
    },
    {
        "id": "ef9ac3fa.d4873",
        "type": "server-state-changed",
        "z": "9889ef6.6e2771",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "switch.hallway_light",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 240,
        "y": 220,
        "wires": [
            [
                "2d5828c1.2bcb68"
            ]
        ]
    },
    {
        "id": "bf7a5591.a95cc8",
        "type": "api-call-service",
        "z": "cfb8073e.876f88",
        "name": "Update state",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "homeassistant",
        "service": "update_entity",
        "entityId": "",
        "data": "{ \"entity_id\": $env('entity_id') }",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 730,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "2282d523.7b19ca",
        "type": "function",
        "z": "cfb8073e.876f88",
        "name": "Light Toggle",
        "func": "const entity = env.get('entity_id');\nconst payloadEntity = msg.payload.event.service_data.entity_id;\nconst payloadDomain = msg.payload.event.domain;\n\nconst correctEntity = Array.isArray(payloadEntity) ? payloadEntity.includes(entity) : payloadEntity === entity;\nconst correctDomain = payloadDomain === 'switch' || payloadDomain === 'light';\nreturn { \n    payload: correctEntity && correctDomain\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 230,
        "y": 40,
        "wires": [
            [
                "e944a0e9.8f98b"
            ]
        ]
    },
    {
        "id": "e944a0e9.8f98b",
        "type": "switch",
        "z": "cfb8073e.876f88",
        "name": "true",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 390,
        "y": 40,
        "wires": [
            [
                "e60caf73.30a49"
            ]
        ]
    },
    {
        "id": "e79da058.cfc2f",
        "type": "trigger",
        "z": "cfb8073e.876f88",
        "name": "",
        "op1": "",
        "op2": "0",
        "op1type": "pay",
        "op2type": "str",
        "duration": "-50",
        "extend": false,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 490,
        "y": 320,
        "wires": [
            [
                "bf7a5591.a95cc8",
                "18d7822a.92842e"
            ]
        ]
    },
    {
        "id": "1241bdd8.2da8c2",
        "type": "change",
        "z": "cfb8073e.876f88",
        "name": "Reset",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 520,
        "wires": [
            [
                "18d7822a.92842e",
                "46f4751b.1d84fc"
            ]
        ]
    },
    {
        "id": "18d7822a.92842e",
        "type": "counter",
        "z": "cfb8073e.876f88",
        "name": "",
        "init": "0",
        "step": "1",
        "lower": "",
        "upper": "",
        "mode": "increment",
        "outputs": "1",
        "x": 740,
        "y": 460,
        "wires": [
            [
                "48443e86.5bc42"
            ]
        ]
    },
    {
        "id": "48443e86.5bc42",
        "type": "switch",
        "z": "cfb8073e.876f88",
        "name": ">10",
        "property": "count",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "10",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 750,
        "y": 520,
        "wires": [
            [
                "1241bdd8.2da8c2"
            ]
        ]
    },
    {
        "id": "b62cc54a.e92368",
        "type": "function",
        "z": "cfb8073e.876f88",
        "name": "Input handler",
        "func": "if (msg.topic === 'service') {\n    return [msg, null];\n}\n\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 150,
        "y": 140,
        "wires": [
            [
                "2282d523.7b19ca"
            ],
            [
                "1241bdd8.2da8c2"
            ]
        ]
    },
    {
        "id": "46f4751b.1d84fc",
        "type": "switch",
        "z": "cfb8073e.876f88",
        "name": "",
        "property": "interval",
        "propertyType": "env",
        "rules": [
            {
                "t": "eq",
                "v": "50",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "125",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 330,
        "y": 340,
        "wires": [
            [
                "e79da058.cfc2f"
            ],
            [
                "878b8c84.67094"
            ]
        ]
    },
    {
        "id": "878b8c84.67094",
        "type": "trigger",
        "z": "cfb8073e.876f88",
        "name": "",
        "op1": "",
        "op2": "0",
        "op1type": "pay",
        "op2type": "str",
        "duration": "-125",
        "extend": false,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 500,
        "y": 360,
        "wires": [
            [
                "18d7822a.92842e",
                "bf7a5591.a95cc8"
            ]
        ]
    },
    {
        "id": "9d0384ee.324008",
        "type": "delay",
        "z": "cfb8073e.876f88",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 490,
        "y": 180,
        "wires": [
            [
                "46f4751b.1d84fc"
            ]
        ]
    },
    {
        "id": "e60caf73.30a49",
        "type": "switch",
        "z": "cfb8073e.876f88",
        "name": "",
        "property": "delay",
        "propertyType": "env",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "50",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "100",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 330,
        "y": 180,
        "wires": [
            [
                "9ccfb807.631b88"
            ],
            [
                "9d0384ee.324008"
            ],
            [
                "893055ff.24d938"
            ]
        ]
    },
    {
        "id": "893055ff.24d938",
        "type": "delay",
        "z": "cfb8073e.876f88",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 490,
        "y": 220,
        "wires": [
            [
                "46f4751b.1d84fc"
            ]
        ]
    },
    {
        "id": "9ccfb807.631b88",
        "type": "delay",
        "z": "cfb8073e.876f88",
        "name": "",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 490,
        "y": 140,
        "wires": [
            [
                "46f4751b.1d84fc"
            ]
        ]
    },
    {
        "id": "2d5828c1.2bcb68",
        "type": "subflow:cfb8073e.876f88",
        "z": "9889ef6.6e2771",
        "name": "Hallway Light",
        "env": [
            {
                "name": "entity_id",
                "value": "switch.hallway_light",
                "type": "str"
            },
            {
                "name": "interval",
                "value": "125",
                "type": "num"
            },
            {
                "name": "delay",
                "value": "100",
                "type": "num"
            }
        ],
        "x": 570,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "6fc54a8c.45b3d4",
        "type": "subflow:cfb8073e.876f88",
        "z": "9889ef6.6e2771",
        "name": "Cabinet Light",
        "env": [
            {
                "name": "entity_id",
                "value": "switch.cabinet_light",
                "type": "str"
            },
            {
                "name": "delay",
                "value": "100",
                "type": "num"
            }
        ],
        "x": 570,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "901be019.50f94",
        "type": "change",
        "z": "9889ef6.6e2771",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "service",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 120,
        "wires": [
            [
                "6fc54a8c.45b3d4",
                "2d5828c1.2bcb68"
            ]
        ]
    },
    {
        "id": "34239bb9.636774",
        "type": "function",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "func": "const states = global.get('homeassistant.homeAssistant.states');\nconst url = states[\"sensor.mail_image_url\"].state;\n\nreturn {\n    \"payload\": {\n    \"notification\": {\n        \"title\": \"Mails & Packages\",\n        \"message\": `âœ‰ï¸ ${msg.payload} New mail(s) coming today (around 1 PM)`,\n        \"data\": {\n            \"tag\": \"mail.coming\",\n            \"image\": url\n        }\n    },\n    \"log\": {\n        \"name\": `USPS (${msg.payload})`,\n        \"entity_id\": \"sensor.mail_usps_mail\",\n        \"message\": \"notified coming today\",\n        \"domain\": \"notify\"\n    }\n}\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 360,
        "y": 1040,
        "wires": [
            [
                "15739cae.559ee3"
            ]
        ]
    },
    {
        "id": "c8e0447.3916eb8",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Master Bedroom Light On",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "light.master_bedroom",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 1500,
        "wires": [
            [
                "71c04cd.e7fc9b4"
            ],
            []
        ]
    },
    {
        "id": "d1b99c80.7fc79",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Set brightness 40",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "light.master_bedroom",
        "data": "{\"entity_id\":\"light.master_bedroom\",\"brightness_pct\":40}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 650,
        "y": 1500,
        "wires": [
            []
        ]
    },
    {
        "id": "f083f14.47fa71",
        "type": "server-state-changed",
        "z": "e2c67c6c.68265",
        "name": "Internet Usage >= 1000 GB",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.internet_monthly",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "1000",
        "halt_if_type": "num",
        "halt_if_compare": "gte",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 160,
        "y": 380,
        "wires": [
            [
                "48c4e4a2.43e3bc"
            ],
            []
        ]
    },
    {
        "id": "48c4e4a2.43e3bc",
        "type": "api-current-state",
        "z": "e2c67c6c.68265",
        "name": "Not warned yet?",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.internet_usage_warned",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 400,
        "y": 380,
        "wires": [
            [
                "6e45d80e.63eab8",
                "d17016fc.c86768"
            ],
            []
        ]
    },
    {
        "id": "bb31d941.e17f28",
        "type": "subflow:670bc302.cb732c",
        "z": "e2c67c6c.68265",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 800,
        "y": 380,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "6e45d80e.63eab8",
        "type": "change",
        "z": "e2c67c6c.68265",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Internet Usage\",\"message\":\"ðŸ“¶ï¸ âš ï¸ Internet usage near limit\",\"data\":{\"tag\":\"internet.usage.warn\",\"priority\":\"high\",\"ttl\":0}},\"log\":{\"name\":\"Internet Sensor (Node Red)\",\"entity_id\":\"sensor.internet_monthly\",\"message\":\"notified near limit\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 380,
        "wires": [
            [
                "bb31d941.e17f28"
            ]
        ]
    },
    {
        "id": "568292bb.39d2ac",
        "type": "cronplus",
        "z": "e2c67c6c.68265",
        "name": "First day of month",
        "outputField": "payload",
        "timeZone": "",
        "persistDynamic": false,
        "commandResponseMsgOutput": "output1",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "default",
                "payload": "",
                "expressionType": "cron",
                "expression": "0 0 0 1 * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 130,
        "y": 440,
        "wires": [
            [
                "e9af206b.6f4e2"
            ]
        ]
    },
    {
        "id": "e9af206b.6f4e2",
        "type": "api-call-service",
        "z": "e2c67c6c.68265",
        "name": "Turn off already warned",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.internet_usage_warned",
        "data": "{\"entity_id\":\"input_boolean.internet_usage_warned\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "d17016fc.c86768",
        "type": "api-call-service",
        "z": "e2c67c6c.68265",
        "name": "Turn on already warned",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "input_boolean.internet_usage_warned",
        "data": "{\"entity_id\":\"input_boolean.internet_usage_warned\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 650,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "fcb006ea.4c4138",
        "type": "comment",
        "z": "e2c67c6c.68265",
        "name": "Internet Usage Warning",
        "info": "",
        "x": 140,
        "y": 340,
        "wires": []
    },
    {
        "id": "c8d3225.cb870e",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "IP address changed",
        "info": "",
        "x": 130,
        "y": 1620,
        "wires": []
    },
    {
        "id": "2aed5089.0f3de",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "IP address",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.ip_address",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "(\\d*)\\.(\\d*)\\.(\\d*)\\.(\\d*)\\b",
        "halt_if_type": "re",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 1660,
        "wires": [
            [
                "f7fc21a3.40a44",
                "19ab0dfe.37a172"
            ],
            []
        ]
    },
    {
        "id": "f7fc21a3.40a44",
        "type": "function",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "func": "return {\n    \"payload\": {\n        \"notification\": {\n            \"title\": \"IP address changed\",\n            \"message\": `ðŸŒ âš ï¸ Your IP address is now ${msg.payload}`,\n            \"data\": {\n                \"tag\": \"internet.ip.warn\",\n                \"priority\": \"high\",\n                \"ttl\": 0\n            }\n        },\n        \"log\": {\n            \"name\": \"IP address (Node Red)\",\n            \"entity_id\": \"sensor.ip_address\",\n            \"message\": \"notified changed\",\n            \"domain\": \"notify\"\n        }\n    }\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 280,
        "y": 1660,
        "wires": [
            [
                "10fff99c.cccc06"
            ]
        ]
    },
    {
        "id": "10fff99c.cccc06",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 460,
        "y": 1660,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "19ab0dfe.37a172",
        "type": "exec",
        "z": "d9fe96b5.8701c8",
        "command": "/data/projects/nodered/update-ip.sh",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Run update-ip.sh",
        "x": 310,
        "y": 1720,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "c5ec2597.8245f8",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Media player paused",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "media_player",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "paused",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 1860,
        "wires": [
            [
                "49856246.1d1fcc"
            ],
            [
                "d5ac8e28.031f3"
            ]
        ]
    },
    {
        "id": "49856246.1d1fcc",
        "type": "trigger",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "10",
        "extend": true,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 370,
        "y": 1860,
        "wires": [
            [
                "5abde545.1ca3cc"
            ]
        ]
    },
    {
        "id": "d5ac8e28.031f3",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 380,
        "y": 1920,
        "wires": [
            [
                "49856246.1d1fcc"
            ]
        ]
    },
    {
        "id": "5abde545.1ca3cc",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Turn off",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "media_player",
        "service": "turn_off",
        "entityId": "",
        "data": "{\"entity_id\":\"{{data.entity_id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 540,
        "y": 1860,
        "wires": [
            []
        ]
    },
    {
        "id": "1b61e899.329287",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "Turn off speaker after 10 mins paused",
        "info": "",
        "x": 190,
        "y": 1820,
        "wires": []
    },
    {
        "id": "5934701d.5e303",
        "type": "function",
        "z": "670bc302.cb732c",
        "name": "",
        "func": "if (msg && msg.payload && msg.payload.notification) {\n    let data = msg.payload.notification.data || {};\n    if (!data.clickAction) {\n        msg.payload.notification.data = Object.assign(data, { clickAction: '/lovelace-test/default_view' });\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 180,
        "y": 100,
        "wires": [
            [
                "5a2b4568.2d2c5c"
            ]
        ]
    },
    {
        "id": "ec5786c1.c3a078",
        "type": "api-call-service",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "",
        "data": "{\"entity_id\":\"{{data.entity_id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1140,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "8906138a.b5a3c",
        "type": "subflow:670bc302.cb732c",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 1100,
        "y": 220,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "e8487d1a.4b6d3",
        "type": "function",
        "z": "955dbfd5.2d3eb",
        "name": "Format for notification/log",
        "func": "return {\n    \"payload\": {\n    \"notification\": {\n        \"title\": \"Water plant\",\n        \"message\": `ðŸŒ± Your plant (${msg.data.attributes.friendly_name}) needs a drink soon!`,\n        \"data\": {\n            \"tag\": `plant.water.${msg.data.entity_id}`,\n            \"actions\": [\n                {\n                    \"title\": \"Done!\",\n                    \"action\": `notification.plant.${msg.data.entity_id}.watered`\n                },\n                {\n                    \"title\": \"Remind me later\",\n                    \"action\": `notification.plant.${msg.data.entity_id}.remind`\n                }\n            ],\n            \"clickAction\": \"/lovelace-test/plants\"\n        }\n    },\n    \"log\": {\n        \"name\": `Plant (${msg.data.attributes.friendly_name})`,\n        \"entity_id\": `${msg.data.entity_id}`,\n        \"message\": \"notified needs watering\",\n        \"domain\": \"notify\"\n    }\n}\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1130,
        "y": 160,
        "wires": [
            [
                "8906138a.b5a3c"
            ]
        ]
    },
    {
        "id": "8135cd3.b1f253",
        "type": "api-call-service",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_datetime",
        "service": "set_datetime",
        "entityId": "",
        "data": "{\"entity_id\":\"{{ entity_id }}\",\"datetime\":\"{{ payload }}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1160,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "380ddbb1.7506c4",
        "type": "function",
        "z": "955dbfd5.2d3eb",
        "name": "Get correct input_datetime",
        "func": "const entity = msg.data.entity_id;\nconst dateEntity = entity.replace('input_boolean', 'input_datetime');\nif (msg.topic === 'datetime') {\n    return null;\n}\n\nif (msg.old_state === 'on') {\n    return null;\n}\n\nreturn {\n    \"entity_id\": dateEntity,\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 520,
        "y": 40,
        "wires": [
            [
                "15c2344c.a3941c"
            ]
        ]
    },
    {
        "id": "15c2344c.a3941c",
        "type": "api-current-state",
        "z": "955dbfd5.2d3eb",
        "name": "Current time",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.date_time_iso",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 810,
        "y": 40,
        "wires": [
            [
                "8135cd3.b1f253"
            ]
        ]
    },
    {
        "id": "6905188a.2cbe08",
        "type": "function",
        "z": "955dbfd5.2d3eb",
        "name": "Get duration",
        "func": "const entity = msg.data.entity_id;\nconst dateEntity = entity.replace('input_boolean', 'input_datetime');\nconst durationEntity = entity.replace('input_boolean', 'input_number');\n\nif (!durationEntity) {\n    node.error(`Not found or zero ${entity}`);\n}\n\nif (durationEntity) {\n    return [{\n        data: msg.data,\n        entity_id: entity,\n        date_entity: dateEntity,\n        duration_entity: durationEntity,\n    }, null];\n}\nreturn [null, null];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 470,
        "y": 160,
        "wires": [
            [
                "ec755d5e.5db34"
            ]
        ]
    },
    {
        "id": "fdcae5ac.b73578",
        "type": "function",
        "z": "955dbfd5.2d3eb",
        "name": "Long enough?",
        "func": "const current = new Date();\nconst whenToWater = new Date(msg.date_payload);\n// convert to seconds\nconst duration = parseFloat(msg.duration_payload) * 24 * 60 * 60;\n\n// minus 6 hours so it can notify earlier\nwhenToWater.setSeconds(whenToWater.getSeconds() + duration - 60*60*6);\n\nif (whenToWater <= current) {\n    const day = current.getDay();\n    const hour = current.getHours();\n    const isWeekend = (day === 6) || (day === 0);\n    const isWeekdayTime = hour >= 18 && hour <= 22;\n    const isWeekendTime = hour >= 9 && hour <= 23;\n    \n    if ((isWeekend && isWeekendTime) || (!isWeekend && isWeekdayTime)) {\n        return [{\n            data: msg.data,\n            entity_id: msg.entity_id,\n        }, null];\n    }\n}\nreturn [null, null];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 920,
        "y": 160,
        "wires": [
            [
                "e8487d1a.4b6d3",
                "ec5786c1.c3a078",
                "5da531f4.e1346"
            ]
        ]
    },
    {
        "id": "ec755d5e.5db34",
        "type": "api-current-state",
        "z": "955dbfd5.2d3eb",
        "name": "last water",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{date_entity}}",
        "state_type": "str",
        "state_location": "date_payload",
        "override_payload": "msg",
        "entity_location": "date_date",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 620,
        "y": 160,
        "wires": [
            [
                "ad8dab1.eb69a58"
            ]
        ]
    },
    {
        "id": "3bc50a55.b9af76",
        "type": "trigger",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "op1": "",
        "op2": "0",
        "op1type": "pay",
        "op2type": "str",
        "duration": "-15",
        "extend": false,
        "units": "min",
        "reset": "",
        "bytopic": "topic",
        "topic": "data.entity_id",
        "outputs": 1,
        "x": 670,
        "y": 260,
        "wires": [
            [
                "6905188a.2cbe08"
            ]
        ]
    },
    {
        "id": "9c7f0498.01f188",
        "type": "switch",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 270,
        "y": 100,
        "wires": [
            [
                "380ddbb1.7506c4",
                "a22622e9.a714d",
                "5da531f4.e1346"
            ],
            [
                "5da531f4.e1346"
            ]
        ]
    },
    {
        "id": "5da531f4.e1346",
        "type": "function",
        "z": "955dbfd5.2d3eb",
        "name": "Reset",
        "func": "return {\n    data: {\n        entity_id: msg.data.entity_id\n    },\n    reset: true\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 450,
        "y": 100,
        "wires": [
            [
                "3bc50a55.b9af76"
            ]
        ]
    },
    {
        "id": "5cd02ad8.fdb3f4",
        "type": "server-state-changed",
        "z": "955dbfd5.2d3eb",
        "name": "Any plant",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.plant_",
        "entityidfiltertype": "substring",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 140,
        "wires": [
            [
                "e532b4bb.4cc058"
            ]
        ]
    },
    {
        "id": "89ccd596.ca4428",
        "type": "server-state-changed",
        "z": "955dbfd5.2d3eb",
        "name": "Any plant watered time",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_datetime.plant_",
        "entityidfiltertype": "substring",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 380,
        "wires": [
            [
                "de996c7f.4fa89"
            ]
        ]
    },
    {
        "id": "de996c7f.4fa89",
        "type": "function",
        "z": "955dbfd5.2d3eb",
        "name": "Get correct input_boolean",
        "func": "const entity = msg.data.entity_id;\nconst booleanEntity = entity.replace('input_datetime', 'input_boolean');\nreturn {\n    topic: 'datetime',\n    data: {\n        \"entity_id\": booleanEntity   \n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 150,
        "y": 320,
        "wires": [
            [
                "c38c160d.9af028"
            ]
        ]
    },
    {
        "id": "c38c160d.9af028",
        "type": "api-current-state",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{data.entity_id}}",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 170,
        "y": 260,
        "wires": [
            [
                "9c7f0498.01f188"
            ]
        ]
    },
    {
        "id": "a22622e9.a714d",
        "type": "delay",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 460,
        "y": 260,
        "wires": [
            [
                "3bc50a55.b9af76"
            ]
        ]
    },
    {
        "id": "3228deac.d96982",
        "type": "comment",
        "z": "955dbfd5.2d3eb",
        "name": "Duration Update",
        "info": "Change Get duration node to update the time between watering any plant",
        "x": 120,
        "y": 40,
        "wires": []
    },
    {
        "id": "e532b4bb.4cc058",
        "type": "function",
        "z": "955dbfd5.2d3eb",
        "name": "Get old state",
        "func": "msg.old_state = msg.data.old_state.state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 110,
        "y": 200,
        "wires": [
            [
                "c38c160d.9af028"
            ]
        ]
    },
    {
        "id": "71c04cd.e7fc9b4",
        "type": "function",
        "z": "d9fe96b5.8701c8",
        "name": "After 11 PM or before 5 AM?",
        "func": "const now = new Date();\nlet cutoff = new Date();\ncutoff.setHours(23);\ncutoff.setMinutes(0);\ncutoff.setSeconds(0);\ncutoff.setMilliseconds(0);\n\nlet cutoffMorning = new Date();\ncutoffMorning.setHours(5);\ncutoffMorning.setMinutes(0);\ncutoffMorning.setSeconds(0);\ncutoffMorning.setMilliseconds(0);\n\n\nif (now > cutoff || now < cutoffMorning) {\n    return [{ payload: true }, null]\n}\n\nreturn [null, { payload: true }];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 400,
        "y": 1500,
        "wires": [
            [
                "d1b99c80.7fc79"
            ],
            [
                "c215c268.d4dbd"
            ]
        ]
    },
    {
        "id": "be42f3e1.aa2a1",
        "type": "api-call-service",
        "z": "b88bc227.1b73f",
        "name": "Turn on light",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "switch",
        "service": "turn_on",
        "entityId": "switch.cabinet_light",
        "data": "{ \"entity_id\": \"switch.cabinet_light\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 830,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "499f21fb.529f2",
        "type": "api-call-service",
        "z": "b88bc227.1b73f",
        "name": "Open back door",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "lock",
        "service": "unlock",
        "entityId": "lock.back_door",
        "data": "{ \"entity_id\": \"lock.back_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 840,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "cad44f85.13f6a",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Back Door unlocked",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "lock.back_door",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "unlocked",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 2000,
        "wires": [
            [
                "c4559723.437258"
            ],
            [
                "95826ba6.719328"
            ]
        ]
    },
    {
        "id": "c4559723.437258",
        "type": "trigger",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "15",
        "extend": true,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 370,
        "y": 2000,
        "wires": [
            [
                "7ce5cedf.20459"
            ]
        ]
    },
    {
        "id": "95826ba6.719328",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 380,
        "y": 2060,
        "wires": [
            [
                "c4559723.437258"
            ]
        ]
    },
    {
        "id": "7ce5cedf.20459",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Lock back door",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "lock",
        "service": "lock",
        "entityId": "lock.back_door",
        "data": "{ \"entity_id\": \"lock.back_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 560,
        "y": 2000,
        "wires": [
            []
        ]
    },
    {
        "id": "69368e4a.f5ef",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Back Door jammed",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.back_door_status",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "Deadbolt Jammed",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 2140,
        "wires": [
            [
                "e7ef2c28.29f4b"
            ],
            []
        ]
    },
    {
        "id": "e7ef2c28.29f4b",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Back door lock\",\"message\":\"ðŸ”’ï¸ âš ï¸ Back door lock jammed!\",\"data\":{\"tag\":\"lock.back_door.error\",\"priority\":\"high\",\"ttl\":0}},\"log\":{\"name\":\"Back door lock (Node Red)\",\"entity_id\":\"lock.back_door\",\"message\":\"notified jammed\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 380,
        "y": 2140,
        "wires": [
            [
                "62f0d6b3.3db638"
            ]
        ]
    },
    {
        "id": "62f0d6b3.3db638",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "x": 560,
        "y": 2140,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "6811e4c7.efddec",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Back Door low battery",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.back_door_status",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "Low Battery",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 2220,
        "wires": [
            [
                "6810334d.3823cc"
            ],
            []
        ]
    },
    {
        "id": "6810334d.3823cc",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Back door lock\",\"message\":\"ðŸ”’ï¸ ðŸ”‹ï¸ Back door lock has low battery\",\"data\":{\"tag\":\"lock.back_door.low_battery\",\"priority\":\"high\",\"ttl\":0}},\"log\":{\"name\":\"Back door lock (Node Red)\",\"entity_id\":\"lock.back_door\",\"message\":\"notified low battery\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 380,
        "y": 2220,
        "wires": [
            [
                "2a7d9855.ce21e8"
            ]
        ]
    },
    {
        "id": "2a7d9855.ce21e8",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "x": 560,
        "y": 2220,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "c4cfbfda.92011",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Back Door critical battery",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.back_door_status",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "Critical Battery Level",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 2300,
        "wires": [
            [
                "6887c24b.752f6c"
            ],
            []
        ]
    },
    {
        "id": "6887c24b.752f6c",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Back door lock\",\"message\":\"ðŸ”’ï¸ ðŸ”‹ï¸ âš ï¸ Back door lock has at critical battery level!\",\"data\":{\"tag\":\"lock.back_door.critical_battery\",\"priority\":\"high\",\"ttl\":0}},\"log\":{\"name\":\"Back door lock (Node Red)\",\"entity_id\":\"lock.back_door\",\"message\":\"notified critical battery level\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 380,
        "y": 2300,
        "wires": [
            [
                "72cfcbbd.9cf054"
            ]
        ]
    },
    {
        "id": "72cfcbbd.9cf054",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [],
        "x": 560,
        "y": 2300,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "86849de1.7c9e3",
        "type": "inject",
        "z": "d9fe96b5.8701c8",
        "name": "10:30 PM weekday ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "30 22 * * 1,2,3,4,0",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 2440,
        "wires": [
            [
                "36cbf9fa.832436"
            ]
        ]
    },
    {
        "id": "36cbf9fa.832436",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Start humidifier",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "switch",
        "service": "turn_on",
        "entityId": "switch.master_bedroom_humidifier",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 360,
        "y": 2440,
        "wires": [
            []
        ]
    },
    {
        "id": "44d80759.960018",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "Humidifier",
        "info": "",
        "x": 100,
        "y": 2400,
        "wires": []
    },
    {
        "id": "d77576d6.333c78",
        "type": "inject",
        "z": "d9fe96b5.8701c8",
        "name": "11:30 PM weekend",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "30 23 * * 5,6",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 2500,
        "wires": [
            [
                "36cbf9fa.832436"
            ]
        ]
    },
    {
        "id": "b208104b.c619c",
        "type": "inject",
        "z": "d9fe96b5.8701c8",
        "name": "8:30 AM weekday ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "30 08 * * 1,2,3,4,5",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 2560,
        "wires": [
            [
                "39525052.942af"
            ]
        ]
    },
    {
        "id": "39525052.942af",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Stop humidifier",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "switch",
        "service": "turn_off",
        "entityId": "switch.master_bedroom_humidifier",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 360,
        "y": 2560,
        "wires": [
            []
        ]
    },
    {
        "id": "4a204f83.aa742",
        "type": "inject",
        "z": "d9fe96b5.8701c8",
        "name": "9:30 AM weekend",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "30 09 * * 6,0",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 2620,
        "wires": [
            [
                "39525052.942af"
            ]
        ]
    },
    {
        "id": "a9609c01.ce21b",
        "type": "server-state-changed",
        "z": "7593ec4d.460434",
        "name": "Garage door open",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "cover.garage_door",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "open",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 60,
        "wires": [
            [
                "347b9f53.a8da"
            ],
            [
                "da9fa58a.72ff18"
            ]
        ]
    },
    {
        "id": "347b9f53.a8da",
        "type": "api-current-state",
        "z": "7593ec4d.460434",
        "name": "Warning enabled",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.gargage_door_warning",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 330,
        "y": 60,
        "wires": [
            [
                "9ac99fb8.a6ed"
            ],
            []
        ]
    },
    {
        "id": "c4a08510.ca05d8",
        "type": "trigger",
        "z": "7593ec4d.460434",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "pay",
        "duration": "-10",
        "extend": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 550,
        "y": 120,
        "wires": [
            [
                "3aa9a529.29ef6a"
            ]
        ]
    },
    {
        "id": "da9fa58a.72ff18",
        "type": "change",
        "z": "7593ec4d.460434",
        "name": "reset",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 120,
        "wires": [
            [
                "9ac99fb8.a6ed",
                "c4a08510.ca05d8"
            ]
        ]
    },
    {
        "id": "111871a0.bad0ae",
        "type": "subflow:670bc302.cb732c",
        "z": "7593ec4d.460434",
        "name": "",
        "x": 740,
        "y": 260,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "984dd037.9e4b4",
        "type": "change",
        "z": "7593ec4d.460434",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Garage door\",\"message\":\" âš ï¸ Garage door is open!\",\"data\":{\"tag\":\"garage_door.open\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Close\",\"action\":\"notification.garage.close\"}]}},\"log\":{\"name\":\"Garage door (Node Red)\",\"entity_id\":\"cover.garage_door\",\"message\":\"notified is open\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 200,
        "wires": [
            [
                "111871a0.bad0ae"
            ]
        ]
    },
    {
        "id": "d86eb4ce.54d518",
        "type": "trigger-state",
        "z": "7593ec4d.460434",
        "name": "Get home",
        "server": "3efaa203.1c443e",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityid": "sensor.minh_home",
        "entityidfiltertype": "exact",
        "debugenabled": false,
        "constraints": [
            {
                "id": "josb7w1otd",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "True"
            },
            {
                "id": "bcqqpcgvs1",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "previous_state",
                "propertyValue": "old_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "False"
            }
        ],
        "constraintsmustmatch": "all",
        "outputs": 2,
        "customoutputs": [],
        "outputinitially": false,
        "state_type": "str",
        "x": 100,
        "y": 400,
        "wires": [
            [
                "e1b46cde.5dab5"
            ],
            []
        ]
    },
    {
        "id": "aaf19894.a381b8",
        "type": "trigger",
        "z": "7593ec4d.460434",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "10",
        "extend": true,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 550,
        "y": 400,
        "wires": [
            [
                "5685809b.c0085"
            ]
        ]
    },
    {
        "id": "e1b46cde.5dab5",
        "type": "api-call-service",
        "z": "7593ec4d.460434",
        "name": "Disable garage warning",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.gargage_door_warning",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 330,
        "y": 400,
        "wires": [
            [
                "aaf19894.a381b8"
            ]
        ]
    },
    {
        "id": "5685809b.c0085",
        "type": "api-call-service",
        "z": "7593ec4d.460434",
        "name": "Enable garage warning",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "input_boolean.gargage_door_warning",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 770,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "3aa9a529.29ef6a",
        "type": "api-current-state",
        "z": "7593ec4d.460434",
        "name": "Warning enabled",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.gargage_door_warning",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 750,
        "y": 120,
        "wires": [
            [
                "e41223ca.c24a6"
            ],
            []
        ]
    },
    {
        "id": "9ac99fb8.a6ed",
        "type": "trigger",
        "z": "7593ec4d.460434",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "2",
        "extend": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 530,
        "y": 60,
        "wires": [
            [
                "c4a08510.ca05d8"
            ]
        ]
    },
    {
        "id": "2a40a77b.5a7148",
        "type": "server-state-changed",
        "z": "7593ec4d.460434",
        "name": "Enable garage warning",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.gargage_door_warning",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 200,
        "wires": [
            [
                "809e99b1.f2ba98"
            ],
            [
                "da9fa58a.72ff18"
            ]
        ]
    },
    {
        "id": "809e99b1.f2ba98",
        "type": "api-current-state",
        "z": "7593ec4d.460434",
        "name": "Garage open",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "open",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "cover.garage_door",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 110,
        "y": 260,
        "wires": [
            [
                "9ac99fb8.a6ed"
            ],
            [
                "da9fa58a.72ff18"
            ]
        ]
    },
    {
        "id": "e41223ca.c24a6",
        "type": "api-current-state",
        "z": "7593ec4d.460434",
        "name": "Garage open",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "open",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "cover.garage_door",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 530,
        "y": 200,
        "wires": [
            [
                "984dd037.9e4b4"
            ],
            []
        ]
    },
    {
        "id": "b043ac1b.3f68a",
        "type": "server-state-changed",
        "z": "7593ec4d.460434",
        "name": "Garage door open",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "cover.garage_door",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "open",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 500,
        "wires": [
            [
                "62325850.5356e8"
            ],
            []
        ]
    },
    {
        "id": "62325850.5356e8",
        "type": "api-current-state",
        "z": "7593ec4d.460434",
        "name": "Sun set",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "below_horizon",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sun.sun",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 320,
        "y": 500,
        "wires": [
            [
                "6464d7fb.bb0678"
            ],
            []
        ]
    },
    {
        "id": "6464d7fb.bb0678",
        "type": "trigger",
        "z": "7593ec4d.460434",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "15",
        "extend": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 490,
        "y": 500,
        "wires": [
            [
                "9648c538.59c178"
            ]
        ]
    },
    {
        "id": "9648c538.59c178",
        "type": "api-call-service",
        "z": "7593ec4d.460434",
        "name": "Close garage",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "cover",
        "service": "close_cover",
        "entityId": "cover.garage_door",
        "data": "{ \"entity_id\": \"cover.garage_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 670,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "2b48b11f.ca6a7e",
        "type": "server-state-changed",
        "z": "7593ec4d.460434",
        "name": "Disable garage warning",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.gargage_door_warning",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 580,
        "wires": [
            [
                "fa99b072.45622"
            ],
            [
                "24457bf.84a1d84"
            ]
        ]
    },
    {
        "id": "fa99b072.45622",
        "type": "trigger",
        "z": "7593ec4d.460434",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "1",
        "extend": true,
        "units": "hr",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 370,
        "y": 580,
        "wires": [
            [
                "cd8b8ef3.f628d"
            ]
        ]
    },
    {
        "id": "cd8b8ef3.f628d",
        "type": "api-call-service",
        "z": "7593ec4d.460434",
        "name": "Enable garage warning",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "input_boolean.gargage_door_warning",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 590,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "24457bf.84a1d84",
        "type": "change",
        "z": "7593ec4d.460434",
        "name": "reset",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 90,
        "y": 640,
        "wires": [
            [
                "fa99b072.45622"
            ]
        ]
    },
    {
        "id": "8fa2404f.3c815",
        "type": "function",
        "z": "955dbfd5.2d3eb",
        "name": "Find correct plant",
        "func": "const action = msg.payload.event.action;\nconst re = /notification\\.plant\\.(input_boolean\\..*)\\..*/;\nconst groups = re.exec(action);\nif (groups && groups.length > 0) {\n    if (action.includes(\"watered\")) {\n        return [{ payload: groups[1] }, null];\n    }\n    \n    if (action.includes(\"remind\")) {\n        return [null, { payload: groups[1] }];\n    }\n\n}\nreturn [null, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 650,
        "y": 500,
        "wires": [
            [
                "d909dcb6.a7d45"
            ],
            [
                "58e02d6d.121c54"
            ]
        ]
    },
    {
        "id": "d909dcb6.a7d45",
        "type": "api-call-service",
        "z": "955dbfd5.2d3eb",
        "name": "Watered",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "",
        "data": "{\"entity_id\":\"{{payload}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 860,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "4100d430.15c68c",
        "type": "server-events",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "server": "3efaa203.1c443e",
        "event_type": "mobile_app_notification_action",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "waitForRunning": true,
        "x": 190,
        "y": 500,
        "wires": [
            [
                "3c68977b.43f078"
            ]
        ]
    },
    {
        "id": "3c68977b.43f078",
        "type": "switch",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "property": "payload.event.action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "notification\\.plant\\.input_boolean\\..*\\..*",
                "vt": "str",
                "case": true
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 450,
        "y": 500,
        "wires": [
            [
                "8fa2404f.3c815"
            ]
        ]
    },
    {
        "id": "58e02d6d.121c54",
        "type": "trigger",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "24",
        "extend": true,
        "units": "hr",
        "reset": "",
        "bytopic": "topic",
        "topic": "payload",
        "outputs": 1,
        "x": 870,
        "y": 560,
        "wires": [
            [
                "e1eb2791.f2b408"
            ]
        ]
    },
    {
        "id": "e1eb2791.f2b408",
        "type": "api-current-state",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{ payload }}",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1100,
        "y": 560,
        "wires": [
            [
                "7ffeec88.3b97b4"
            ]
        ]
    },
    {
        "id": "7ffeec88.3b97b4",
        "type": "switch",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 500,
        "wires": [
            [
                "bb242b83.ace9e8"
            ],
            [
                "e8487d1a.4b6d3"
            ]
        ]
    },
    {
        "id": "bb242b83.ace9e8",
        "type": "change",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 440,
        "wires": [
            [
                "58e02d6d.121c54"
            ]
        ]
    },
    {
        "id": "4cde0340.990cec",
        "type": "inject",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 690,
        "y": 440,
        "wires": [
            [
                "bb242b83.ace9e8"
            ]
        ]
    },
    {
        "id": "5fb4b596.c747fc",
        "type": "server-state-changed",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.plant_",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 180,
        "y": 580,
        "wires": [
            [
                "33ba7dbc.d08a12"
            ],
            [
                "5a86280a.6f68f8"
            ]
        ]
    },
    {
        "id": "33ba7dbc.d08a12",
        "type": "change",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 560,
        "wires": [
            [
                "bb242b83.ace9e8"
            ]
        ]
    },
    {
        "id": "5a86280a.6f68f8",
        "type": "change",
        "z": "955dbfd5.2d3eb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 620,
        "wires": [
            [
                "58e02d6d.121c54"
            ]
        ]
    },
    {
        "id": "9ef1f0da.1fa7e",
        "type": "inject",
        "z": "d9fe96b5.8701c8",
        "name": "11 PM",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 23 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 1560,
        "wires": [
            [
                "1cb02712.9c9a59"
            ]
        ]
    },
    {
        "id": "1cb02712.9c9a59",
        "type": "api-current-state",
        "z": "d9fe96b5.8701c8",
        "name": "Master Bedroom Light On",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.master_bedroom",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 330,
        "y": 1560,
        "wires": [
            [
                "d1b99c80.7fc79"
            ],
            []
        ]
    },
    {
        "id": "c215c268.d4dbd",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Set brightness 100",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "light.master_bedroom",
        "data": "{\"entity_id\":\"light.master_bedroom\",\"brightness_pct\":100}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 650,
        "y": 1560,
        "wires": [
            []
        ]
    },
    {
        "id": "bb915af7.11a448",
        "type": "trigger-state",
        "z": "7593ec4d.460434",
        "name": "Get home",
        "server": "3efaa203.1c443e",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityid": "sensor.minh_home",
        "entityidfiltertype": "exact",
        "debugenabled": false,
        "constraints": [
            {
                "id": "josb7w1otd",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "True"
            },
            {
                "id": "bcqqpcgvs1",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "previous_state",
                "propertyValue": "old_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "False"
            }
        ],
        "constraintsmustmatch": "all",
        "outputs": 2,
        "customoutputs": [],
        "outputinitially": false,
        "state_type": "str",
        "x": 100,
        "y": 860,
        "wires": [
            [
                "f5d444ad.1f8228"
            ],
            []
        ]
    },
    {
        "id": "a74bc448.ba6c08",
        "type": "subflow:670bc302.cb732c",
        "z": "7593ec4d.460434",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 540,
        "y": 800,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "5b0ed22c.3d17dc",
        "type": "change",
        "z": "7593ec4d.460434",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Home\",\"message\":\"Are you home?\",\"data\":{\"tag\":\"tracker.home\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Open garage\",\"action\":\"notification.garage.open\"}]}},\"log\":{\"name\":\"Phone_M (Node Red)\",\"entity_id\":\"device_tracker.phone_m\",\"message\":\"notified getting home\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 800,
        "wires": [
            [
                "a74bc448.ba6c08"
            ]
        ]
    },
    {
        "id": "848bdc33.a57dd",
        "type": "api-current-state",
        "z": "7593ec4d.460434",
        "name": "Auto open enabled",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.gargage_door_auto_open",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 130,
        "y": 740,
        "wires": [
            [
                "937ce12.014472"
            ],
            [
                "5b0ed22c.3d17dc"
            ]
        ]
    },
    {
        "id": "ef87250c.b33c88",
        "type": "switch",
        "z": "7593ec4d.460434",
        "name": "Gone for >20 mins",
        "property": "custom.time_passed_minutes",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "20",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 490,
        "y": 740,
        "wires": [
            [
                "52e451ab.13e37"
            ],
            [
                "5b0ed22c.3d17dc"
            ]
        ]
    },
    {
        "id": "52748450.9cb55c",
        "type": "api-call-service",
        "z": "7593ec4d.460434",
        "name": "Turn on light",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "switch",
        "service": "turn_on",
        "entityId": "switch.cabinet_light",
        "data": "{ \"entity_id\": \"switch.cabinet_light\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 990,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "7f0c2432.e86ddc",
        "type": "api-call-service",
        "z": "7593ec4d.460434",
        "name": "Open back door",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "lock",
        "service": "unlock",
        "entityId": "lock.back_door",
        "data": "{ \"entity_id\": \"lock.back_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1000,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "3bb1ac2e.568434",
        "type": "api-call-service",
        "z": "7593ec4d.460434",
        "name": "Open garage",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "cover",
        "service": "open_cover",
        "entityId": "cover.garage_door",
        "data": "{ \"entity_id\": \"cover.garage_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 990,
        "y": 740,
        "wires": [
            [
                "52748450.9cb55c",
                "7f0c2432.e86ddc",
                "c7b8b7d5.b46958"
            ]
        ]
    },
    {
        "id": "ea6ed80.8c7ec28",
        "type": "change",
        "z": "7593ec4d.460434",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Home\",\"message\":\"Welcome home! Gargage and back door have been unlocked.\",\"data\":{\"tag\":\"tracker.home.warning\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Close garage\",\"action\":\"notification.garage.close\"}]}},\"log\":{\"name\":\"Minh Home (Node Red)\",\"entity_id\":\"sensor.minh_home\",\"message\":\"notified welcome home\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 900,
        "wires": [
            [
                "92035a81.0a3688"
            ]
        ]
    },
    {
        "id": "92035a81.0a3688",
        "type": "subflow:670bc302.cb732c",
        "z": "7593ec4d.460434",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 840,
        "y": 900,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "52e451ab.13e37",
        "type": "function",
        "z": "7593ec4d.460434",
        "name": "Before 12 AM or after 11 AM?",
        "func": "const now = new Date();\nlet cutoff = new Date();\ncutoff.setHours(23);\ncutoff.setMinutes(59);\ncutoff.setSeconds(0);\ncutoff.setMilliseconds(0);\n\nlet cutoffMorning = new Date();\ncutoffMorning.setHours(11);\ncutoffMorning.setMinutes(0);\ncutoffMorning.setSeconds(0);\ncutoffMorning.setMilliseconds(0);\n\n\nif (now < cutoff || now > cutoffMorning) {\n    return [{ payload: true }, null]\n}\n\nreturn [null, { payload: true }];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 740,
        "y": 740,
        "wires": [
            [
                "3bb1ac2e.568434",
                "ea6ed80.8c7ec28"
            ],
            [
                "5b0ed22c.3d17dc"
            ]
        ]
    },
    {
        "id": "a1c016c8.f65298",
        "type": "subflow:670bc302.cb732c",
        "z": "7593ec4d.460434",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 500,
        "y": 980,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "35ff688c.a37368",
        "type": "change",
        "z": "7593ec4d.460434",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Home\",\"message\":\"Are you leaving?\",\"data\":{\"tag\":\"tracker.away\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Close garage\",\"action\":\"notification.garage.close\"}]}},\"log\":{\"name\":\"Phone_M (Node Red)\",\"entity_id\":\"device_tracker.phone_m\",\"message\":\"notified leaving home\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 980,
        "wires": [
            [
                "a1c016c8.f65298"
            ]
        ]
    },
    {
        "id": "19e4fd1c.9dad93",
        "type": "api-call-service",
        "z": "7593ec4d.460434",
        "name": "Lock back door",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "lock",
        "service": "lock",
        "entityId": "lock.back_door",
        "data": "{ \"entity_id\": \"lock.back_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 500,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "c7b8b7d5.b46958",
        "type": "trigger",
        "z": "7593ec4d.460434",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "15",
        "extend": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 810,
        "y": 680,
        "wires": [
            [
                "b03e44bd.d841c8"
            ]
        ]
    },
    {
        "id": "b03e44bd.d841c8",
        "type": "api-call-service",
        "z": "7593ec4d.460434",
        "name": "Close garage",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "cover",
        "service": "close_cover",
        "entityId": "cover.garage_door",
        "data": "{ \"entity_id\": \"cover.garage_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 990,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "47178354.2fc07c",
        "type": "server-state-changed",
        "z": "7593ec4d.460434",
        "name": "Garage door closed",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "cover.garage_door",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "closed",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 490,
        "y": 680,
        "wires": [
            [
                "246ee6a4.5ef8ba"
            ],
            []
        ]
    },
    {
        "id": "246ee6a4.5ef8ba",
        "type": "change",
        "z": "7593ec4d.460434",
        "name": "reset",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 680,
        "wires": [
            [
                "c7b8b7d5.b46958"
            ]
        ]
    },
    {
        "id": "d84e8051.7cbaf",
        "type": "api-current-state",
        "z": "7593ec4d.460434",
        "name": "Not locked",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "unlocked",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "lock.back_door",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 290,
        "y": 1040,
        "wires": [
            [
                "19e4fd1c.9dad93"
            ],
            []
        ]
    },
    {
        "id": "937ce12.014472",
        "type": "api-current-state",
        "z": "7593ec4d.460434",
        "name": "Home status",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.minh_home",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 310,
        "y": 740,
        "wires": [
            [
                "ef87250c.b33c88"
            ]
        ]
    },
    {
        "id": "f5d444ad.1f8228",
        "type": "function",
        "z": "7593ec4d.460434",
        "name": "Time passed",
        "func": "const after = new Date(msg.data.event.new_state.last_changed);\nconst before = new Date(msg.data.event.old_state.last_changed);\n\nmsg.custom = {\n    time_passed_minutes: (after - before) / 1000 / 60\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 110,
        "y": 800,
        "wires": [
            [
                "848bdc33.a57dd"
            ]
        ]
    },
    {
        "id": "94baf0cc.44e5a",
        "type": "server-state-changed",
        "z": "955dbfd5.2d3eb",
        "name": "Days between water change",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "number.plant_",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 420,
        "y": 380,
        "wires": [
            [
                "ae37436e.51662"
            ]
        ]
    },
    {
        "id": "ae37436e.51662",
        "type": "function",
        "z": "955dbfd5.2d3eb",
        "name": "Get correct input_boolean",
        "func": "const entity = msg.data.entity_id;\nconst booleanEntity = entity.replace('input_number', 'input_boolean');\nreturn {\n    topic: 'number',\n    data: {\n        \"entity_id\": booleanEntity   \n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 320,
        "wires": [
            [
                "c38c160d.9af028"
            ]
        ]
    },
    {
        "id": "ad8dab1.eb69a58",
        "type": "api-current-state",
        "z": "955dbfd5.2d3eb",
        "name": "duration",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{duration_entity}}",
        "state_type": "str",
        "state_location": "duration_payload",
        "override_payload": "msg",
        "entity_location": "duration_duration",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 760,
        "y": 160,
        "wires": [
            [
                "fdcae5ac.b73578"
            ]
        ]
    },
    {
        "id": "83d1999c.6ec8e8",
        "type": "trigger-state",
        "z": "7593ec4d.460434",
        "name": "Leave home",
        "server": "3efaa203.1c443e",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityid": "sensor.minh_home",
        "entityidfiltertype": "exact",
        "debugenabled": false,
        "constraints": [
            {
                "id": "p685nuwsn7b",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "False"
            }
        ],
        "constraintsmustmatch": "all",
        "outputs": 2,
        "customoutputs": [],
        "outputinitially": false,
        "state_type": "str",
        "x": 110,
        "y": 980,
        "wires": [
            [
                "35ff688c.a37368",
                "d84e8051.7cbaf"
            ],
            []
        ]
    },
    {
        "id": "3a1734ff.f66c3c",
        "type": "inject",
        "z": "d9fe96b5.8701c8",
        "name": "Check washer open",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 09 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 520,
        "wires": [
            [
                "2f36c481.ff36fc"
            ]
        ]
    },
    {
        "id": "2f36c481.ff36fc",
        "type": "api-current-state",
        "z": "d9fe96b5.8701c8",
        "name": "Washer open",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.washing_machine_open",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 350,
        "y": 520,
        "wires": [
            [
                "ece4b2e0.a9fe6"
            ],
            []
        ]
    },
    {
        "id": "58d79d93.8c6ac4",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 720,
        "y": 520,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "ece4b2e0.a9fe6",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Washing machine is closed\",\"message\":\" âš ï¸ Washing machine needs to be open!\",\"data\":{\"tag\":\"washing_machine.warn\",\"actions\":[{\"title\":\"Done\",\"action\":\"notification.washing_machine.open\"}]}},\"log\":{\"name\":\"Washing Machine (Node Red)\",\"entity_id\":\"input_boolean.washing_machine_open\",\"message\":\"notified closed warning\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 520,
        "wires": [
            [
                "58d79d93.8c6ac4"
            ]
        ]
    },
    {
        "id": "7f27f835.6c5048",
        "type": "inject",
        "z": "d9fe96b5.8701c8",
        "name": "Check humidifier filled",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 15 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 580,
        "wires": [
            [
                "444d24d.96311dc"
            ]
        ]
    },
    {
        "id": "17e68f4b.b1d7b1",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "",
                "type": "json"
            },
            {
                "name": "log",
                "value": "",
                "type": "json"
            }
        ],
        "x": 820,
        "y": 580,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "8e88caaa.092b08",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Humidifier needs to be filled\",\"message\":\" âš ï¸ Humidifier needs to be filled!\",\"data\":{\"tag\":\"humidifier.warn\",\"actions\":[{\"title\":\"Done\",\"action\":\"notification.humidifier.fill\"}]}},\"log\":{\"name\":\"Humidifier Filled (Node Red)\",\"entity_id\":\"input_boolean.humidifier_filled\",\"message\":\"notified not filled warning\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 580,
        "wires": [
            [
                "17e68f4b.b1d7b1"
            ]
        ]
    },
    {
        "id": "444d24d.96311dc",
        "type": "api-current-state",
        "z": "d9fe96b5.8701c8",
        "name": "Last filled",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_datetime.humidifier_filled",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 360,
        "y": 580,
        "wires": [
            [
                "8de2244e.a54288"
            ]
        ]
    },
    {
        "id": "8de2244e.a54288",
        "type": "function",
        "z": "d9fe96b5.8701c8",
        "name": "> 36 hours",
        "func": "const now = Date.now();\nconst lastFilled = new Date(msg.payload).getTime();\n// convert to hours\nconst duration = parseFloat(now - lastFilled) / (1000 * 60 * 60);\n\nif (duration > 36) {\n    return {\n        payload: true\n    };\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 390,
        "y": 640,
        "wires": [
            [
                "8e88caaa.092b08",
                "9b7b26f0.3f9c38"
            ]
        ]
    },
    {
        "id": "14f44ef5.8a7cf1",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Humidifier filled",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.humidifier_filled",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 700,
        "wires": [
            [
                "f2f853d4.1dfde"
            ],
            []
        ]
    },
    {
        "id": "fb6d520f.31ad7",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_datetime",
        "service": "set_datetime",
        "entityId": "",
        "data": "{\"entity_id\":\"input_datetime.humidifier_filled\",\"datetime\":\"{{ payload }}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 580,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "f2f853d4.1dfde",
        "type": "api-current-state",
        "z": "d9fe96b5.8701c8",
        "name": "Current time",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.date_time_iso",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 330,
        "y": 700,
        "wires": [
            [
                "fb6d520f.31ad7"
            ]
        ]
    },
    {
        "id": "9b7b26f0.3f9c38",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.humidifer_filled",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 660,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "72da23c9.44b4bc",
        "type": "api-call-service",
        "z": "b88bc227.1b73f",
        "name": "Washing machine open",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "input_boolean.washing_machine_open",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 670,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "da01d7df.4fbd18",
        "type": "api-call-service",
        "z": "b88bc227.1b73f",
        "name": "Humidifier filled",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "input_boolean.humidifier_filled",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 640,
        "y": 320,
        "wires": [
            []
        ]
    }
]