[
    {
        "id": "d9fe96b5.8701c8",
        "type": "tab",
        "label": "Simple automations",
        "disabled": false,
        "info": ""
    },
    {
        "id": "b88bc227.1b73f",
        "type": "tab",
        "label": "Mobile action listeners",
        "disabled": false,
        "info": ""
    },
    {
        "id": "9889ef6.6e2771",
        "type": "tab",
        "label": "Event listeners",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e2c67c6c.68265",
        "type": "tab",
        "label": "Reminders",
        "disabled": false,
        "info": ""
    },
    {
        "id": "670bc302.cb732c",
        "type": "subflow",
        "name": "Notify HA apps",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 100,
                "wires": [
                    {
                        "id": "5a2b4568.2d2c5c"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "cfb8073e.876f88",
        "type": "subflow",
        "name": "Update light state",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 20,
                "y": 140,
                "wires": [
                    {
                        "id": "b62cc54a.e92368"
                    }
                ]
            }
        ],
        "out": [],
        "env": [
            {
                "name": "entity_id",
                "type": "str",
                "value": ""
            },
            {
                "name": "interval",
                "type": "num",
                "value": "50"
            },
            {
                "name": "delay",
                "type": "num",
                "value": "0"
            }
        ],
        "color": "#DDAA99"
    },
    {
        "id": "3efaa203.1c443e",
        "type": "server",
        "z": "",
        "name": "Home Assistant",
        "legacy": false,
        "addon": false,
        "rejectUnauthorizedCerts": false,
        "ha_boolean": "y|yes|true|on|home|open",
        "connectionDelay": true,
        "cacheJson": false
    },
    {
        "id": "fea39eb8.12411",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "Notifiy about rain",
        "info": "",
        "x": 120,
        "y": 60,
        "wires": []
    },
    {
        "id": "a4a51bd5.cbf1a8",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "If it's rainy",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "weather.kpvu_hourly",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "rainy",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 100,
        "wires": [
            [
                "27015fcf.eaa1e"
            ],
            []
        ]
    },
    {
        "id": "cfbda5ba.dea498",
        "type": "inject",
        "z": "d9fe96b5.8701c8",
        "name": "3 AM everyday ",
        "repeat": "",
        "crontab": "00 03 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 340,
        "wires": [
            [
                "c499881d.445368"
            ]
        ]
    },
    {
        "id": "795b7b3e.e3f064",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Start vacuum",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "vacuum",
        "service": "start",
        "entityId": "vacuum.roborock",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 550,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "c499881d.445368",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Set max fan speed",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "vacuum",
        "service": "set_fan_speed",
        "entityId": "vacuum.roborock",
        "data": "{\"fan_speed\":\"max\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 350,
        "y": 340,
        "wires": [
            [
                "795b7b3e.e3f064"
            ]
        ]
    },
    {
        "id": "f2f183f9.0381c",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "Run vacumm every morning",
        "info": "",
        "x": 160,
        "y": 300,
        "wires": []
    },
    {
        "id": "3e215458.36073c",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Vacuum error",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "vacuum.roborock",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "error",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 110,
        "y": 420,
        "wires": [
            [
                "d46beef9.4f088"
            ],
            []
        ]
    },
    {
        "id": "d5b4c56e.e9c588",
        "type": "trigger-state",
        "z": "d9fe96b5.8701c8",
        "name": "Rain stopped",
        "server": "3efaa203.1c443e",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityid": "weather.kpvu_hourly",
        "entityidfiltertype": "exact",
        "debugenabled": false,
        "constraints": [
            {
                "id": "p7a1tr6c15",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is_not",
                "comparatorValueDatatype": "str",
                "comparatorValue": "rainy"
            },
            {
                "id": "vrfqo44y8r",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "previous_state",
                "propertyValue": "old_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "rainy"
            }
        ],
        "constraintsmustmatch": "all",
        "outputs": 2,
        "customoutputs": [],
        "outputinitially": false,
        "state_type": "str",
        "x": 110,
        "y": 180,
        "wires": [
            [
                "228dd1fe.a262ce"
            ],
            []
        ]
    },
    {
        "id": "442ab0e0.9b202",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "{\"title\":\"Weather\",\"message\":\"‚õÖ It stopped raining\",\"data\":{\"tag\":\"weather.rain.stop\",\"priority\":\"normal\",\"ttl\":0}}",
                "type": "json"
            },
            {
                "name": "log",
                "value": "{\"name\":\"Weather (Node Red)\",\"entity_id\":\"weather.kpvu_hourly\",\"message\":\"notified rain stopped\",\"domain\":\"notify\"}",
                "type": "json"
            }
        ],
        "x": 480,
        "y": 180,
        "wires": []
    },
    {
        "id": "f5b4874.c820978",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "{\"title\":\"Weather\",\"message\":\"üåßÔ∏è It might be raining\",\"data\":{\"tag\":\"weather.rain.start\",\"priority\":\"high\",\"ttl\":0}}",
                "type": "json"
            },
            {
                "name": "log",
                "value": "{\"name\":\"Weather (Node Red)\",\"entity_id\":\"weather.kpvu_hourly\",\"message\":\"notified rain\",\"domain\":\"notify\"}",
                "type": "json"
            }
        ],
        "x": 480,
        "y": 100,
        "wires": []
    },
    {
        "id": "35e31cc.f48d0e4",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "{\"title\":\"Roborock Vacuum\",\"message\":\"üßπÔ∏è ‚ö†Ô∏è Vacuum in error state\",\"data\":{\"tag\":\"vacuum.error\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Find robot\",\"action\":\"notification.vacuum.roborock.find\"}]}}",
                "type": "json"
            },
            {
                "name": "log",
                "value": "{\"name\":\"Roborock (Node Red)\",\"entity_id\":\"vacuum.roborock\",\"message\":\"notified error\",\"domain\":\"notify\"}",
                "type": "json"
            }
        ],
        "x": 480,
        "y": 420,
        "wires": []
    },
    {
        "id": "7c8c59df.9fc818",
        "type": "comment",
        "z": "670bc302.cb732c",
        "name": "Notify HA apps & logs to HA",
        "info": "",
        "x": 160,
        "y": 40,
        "wires": []
    },
    {
        "id": "623970e8.0aa2f",
        "type": "server-events",
        "z": "b88bc227.1b73f",
        "name": "",
        "server": "3efaa203.1c443e",
        "event_type": "mobile_app_notification_action",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "x": 190,
        "y": 60,
        "wires": [
            [
                "3c2f703.3aecf9"
            ]
        ]
    },
    {
        "id": "3c2f703.3aecf9",
        "type": "switch",
        "z": "b88bc227.1b73f",
        "name": "",
        "property": "payload.event.action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "notification.vacuum.roborock.find",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "notification.garage.open",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "notification.garage.close",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 450,
        "y": 60,
        "wires": [
            [
                "752d962a.3714c8"
            ],
            [
                "586abfa1.56235"
            ],
            [
                "e38a2c4c.2afee"
            ]
        ]
    },
    {
        "id": "752d962a.3714c8",
        "type": "api-call-service",
        "z": "b88bc227.1b73f",
        "name": "Find robot",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "vacuum",
        "service": "locate",
        "entityId": "vacuum.roborock",
        "data": "{ \"entity_id\": \"vacuum.roborock\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 620,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "3ea02219.60e39e",
        "type": "inject",
        "z": "e2c67c6c.68265",
        "name": "8 PM Wednesday",
        "props": [],
        "repeat": "",
        "crontab": "00 20 * * 3",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "e6e88d4e.59b0e"
            ]
        ]
    },
    {
        "id": "5cad1124.07924",
        "type": "subflow:670bc302.cb732c",
        "z": "e2c67c6c.68265",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "{\"title\":\"Trash day\",\"message\":\"üóëDon't forget to take the trash out!\",\"data\":{\"tag\":\"trash.reminder\",\"priority\":\"high\",\"ttl\":0}}",
                "type": "json"
            },
            {
                "name": "log",
                "value": "{\"name\":\"Trash day reminder\",\"message\":\"reminded to take trash out\",\"domain\":\"notify\"}",
                "type": "json"
            }
        ],
        "x": 580,
        "y": 100,
        "wires": []
    },
    {
        "id": "815f4d5.29d7fb",
        "type": "comment",
        "z": "e2c67c6c.68265",
        "name": "Reminder to take trash in/out",
        "info": "",
        "x": 160,
        "y": 60,
        "wires": []
    },
    {
        "id": "42be322c.cb3ccc",
        "type": "inject",
        "z": "e2c67c6c.68265",
        "name": "4 PM Thursday",
        "props": [],
        "repeat": "",
        "crontab": "00 16 * * 4",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 120,
        "y": 160,
        "wires": [
            [
                "e3a8c10d.9e079"
            ]
        ]
    },
    {
        "id": "a73fc1db.8105",
        "type": "subflow:670bc302.cb732c",
        "z": "e2c67c6c.68265",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "{\"title\":\"After trash day\",\"message\":\"üóëDon't forget to take the trash IN!\",\"data\":{\"tag\":\"trash.reminder\",\"priority\":\"high\",\"ttl\":0}}",
                "type": "json"
            },
            {
                "name": "log",
                "value": "{\"name\":\"Trash day reminder\",\"message\":\"reminded to take trash IN\",\"domain\":\"notify\"}",
                "type": "json"
            }
        ],
        "x": 580,
        "y": 160,
        "wires": []
    },
    {
        "id": "221dbd01.cfcc72",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "{\"title\":\"Home\",\"message\":\"Are you home?\",\"data\":{\"tag\":\"tracker.home\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Open garage\",\"action\":\"notification.garage.open\"}]}}",
                "type": "json"
            },
            {
                "name": "log",
                "value": "{\"name\":\"Phone_M (Node Red)\",\"entity_id\":\"device_tracker.phone_m\",\"message\":\"notified getting home\",\"domain\":\"notify\"}",
                "type": "json"
            }
        ],
        "x": 500,
        "y": 560,
        "wires": []
    },
    {
        "id": "586abfa1.56235",
        "type": "api-call-service",
        "z": "b88bc227.1b73f",
        "name": "Open garage",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "cover",
        "service": "open_cover",
        "entityId": "cover.garage_door",
        "data": "{ \"entity_id\": \"cover.garage_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 630,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "e38a2c4c.2afee",
        "type": "api-call-service",
        "z": "b88bc227.1b73f",
        "name": "Close garage",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "cover",
        "service": "close_cover",
        "entityId": "cover.garage_door",
        "data": "{ \"entity_id\": \"cover.garage_door\" }",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 630,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "7d9a63dd.b19d9c",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Leave home",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "device_tracker.phone_m",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "not_home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 110,
        "y": 640,
        "wires": [
            [
                "cacdd83b.903998"
            ],
            []
        ]
    },
    {
        "id": "82e5cfd.7e9fd3",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "{\"title\":\"Home\",\"message\":\"Are you leaving?\",\"data\":{\"tag\":\"tracker.away\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Close garage\",\"action\":\"notification.garage.close\"}]}}",
                "type": "json"
            },
            {
                "name": "log",
                "value": "{\"name\":\"Phone_M (Node Red)\",\"entity_id\":\"device_tracker.phone_m\",\"message\":\"notified leaving home\",\"domain\":\"notify\"}",
                "type": "json"
            }
        ],
        "x": 500,
        "y": 640,
        "wires": []
    },
    {
        "id": "30345639.3b764a",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "Get/ leave home",
        "info": "",
        "x": 120,
        "y": 520,
        "wires": []
    },
    {
        "id": "83569a96.d150f8",
        "type": "trigger-state",
        "z": "d9fe96b5.8701c8",
        "name": "Get home",
        "server": "3efaa203.1c443e",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityid": "sensor.minh_home",
        "entityidfiltertype": "exact",
        "debugenabled": false,
        "constraints": [
            {
                "id": "josb7w1otd",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "True"
            },
            {
                "id": "bcqqpcgvs1",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "previous_state",
                "propertyValue": "old_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "False"
            }
        ],
        "constraintsmustmatch": "all",
        "outputs": 2,
        "customoutputs": [],
        "outputinitially": false,
        "state_type": "str",
        "x": 100,
        "y": 560,
        "wires": [
            [
                "35bc2563.b521fa"
            ],
            []
        ]
    },
    {
        "id": "8d434d29.85a88",
        "type": "api-call-service",
        "z": "9889ef6.6e2771",
        "name": "Set noctis theme",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "frontend",
        "service": "set_theme",
        "entityId": "",
        "data": "{\"name\":\"noctis\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 310,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "a99c435.39e9ec",
        "type": "inject",
        "z": "e2c67c6c.68265",
        "name": "8 PM everyday",
        "props": [],
        "repeat": "",
        "crontab": "00 20 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 120,
        "y": 260,
        "wires": [
            [
                "a349aaf7.243f98"
            ]
        ]
    },
    {
        "id": "c1faf23d.8072d",
        "type": "subflow:670bc302.cb732c",
        "z": "e2c67c6c.68265",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "{\"title\":\"Watering\",\"message\":\"üåø Don't forget to water the herbs!\",\"data\":{\"tag\":\"plant.reminder\"}}",
                "type": "json"
            },
            {
                "name": "log",
                "value": "{\"name\":\"Plant watering reminder\",\"message\":\"reminded water plants\",\"domain\":\"notify\"}",
                "type": "json"
            }
        ],
        "x": 580,
        "y": 260,
        "wires": []
    },
    {
        "id": "f848aa1a.681a98",
        "type": "comment",
        "z": "e2c67c6c.68265",
        "name": "Reminder to water herbs",
        "info": "",
        "x": 150,
        "y": 220,
        "wires": []
    },
    {
        "id": "ddad8919.724b68",
        "type": "server-events",
        "z": "9889ef6.6e2771",
        "name": "",
        "server": "3efaa203.1c443e",
        "event_type": "call_service",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "waitForRunning": true,
        "x": 90,
        "y": 120,
        "wires": [
            [
                "61d5e76f.eaa9d8",
                "901be019.50f94"
            ]
        ]
    },
    {
        "id": "c10ad374.4a6cd",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "USPS Delivered",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.mail_usps_delivered",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 780,
        "wires": [
            [
                "b60867ef.dba148"
            ],
            []
        ]
    },
    {
        "id": "4257a54c.c5696c",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "UPS Delivered",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.mail_ups_delivered",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 840,
        "wires": [
            [
                "230417ea.7965a8"
            ],
            []
        ]
    },
    {
        "id": "7a0839f3.3014a8",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Fedex Delivered",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.mail_fedex_delivered",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 900,
        "wires": [
            [
                "b43bd907.3ae248"
            ],
            []
        ]
    },
    {
        "id": "601b8ab1.27f8e4",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "{\"title\":\"Mails & Packages\",\"message\":\"üì¶ New package(s) delivered \",\"data\":{\"tag\":\"package.delivered\",\"priority\":\"high\",\"ttl\":0}}",
                "type": "json"
            },
            {
                "name": "log",
                "value": "{\"name\":\"Mail/package (Node Red)\",\"entity_id\":\"sensor.mail_packages_delivered\",\"message\":\"notified delivered\",\"domain\":\"notify\"}",
                "type": "json"
            }
        ],
        "x": 720,
        "y": 840,
        "wires": []
    },
    {
        "id": "b60867ef.dba148",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{ \"count\": $$.data.new_state.state - $$.data.old_state.state, \"carrier\": \"USPS\" }",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 780,
        "wires": [
            [
                "ec5c4d8e.e2185"
            ]
        ]
    },
    {
        "id": "230417ea.7965a8",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{ \"count\": $$.data.new_state.state - $$.data.old_state.state, \"carrier\": \"UPS\" }",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 840,
        "wires": [
            [
                "ec5c4d8e.e2185"
            ]
        ]
    },
    {
        "id": "b43bd907.3ae248",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{ \"count\": $$.data.new_state.state - $$.data.old_state.state, \"carrier\": \"Fedex\" }",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 900,
        "wires": [
            [
                "ec5c4d8e.e2185"
            ]
        ]
    },
    {
        "id": "257351ca.c2b3be",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "New package(s) delivered",
        "info": "",
        "x": 150,
        "y": 720,
        "wires": []
    },
    {
        "id": "68cc1ff9.b3b1e",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "USPS Mail Coming Today",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.mail_usps_mail",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 1040,
        "wires": [
            [
                "13ac7cce.77c6e3"
            ],
            []
        ]
    },
    {
        "id": "15739cae.559ee3",
        "type": "subflow:670bc302.cb732c",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "env": [
            {
                "name": "notification",
                "value": "{\"title\":\"Mails & Packages\",\"message\":\"‚úâÔ∏èÔ∏è New mail(s)coming to mailbox today (around 1 PM) \",\"data\":{\"tag\":\"mail.delivered\",\"priority\":\"high\",\"ttl\":0}}",
                "type": "json"
            },
            {
                "name": "log",
                "value": "{\"name\":\"Mail (Node Red)\",\"entity_id\":\"sensor.mail_usps_mail\",\"message\":\"notified delivered\",\"domain\":\"notify\"}",
                "type": "json"
            }
        ],
        "x": 580,
        "y": 1040,
        "wires": []
    },
    {
        "id": "e2f0473b.d22fe8",
        "type": "inject",
        "z": "9889ef6.6e2771",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 60,
        "wires": [
            [
                "8d434d29.85a88"
            ]
        ]
    },
    {
        "id": "7434d2eb.da0c3c",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Amazon Delivered",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.mail_amazon_packages_delivered",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 960,
        "wires": [
            [
                "91d7fb52.d922d8"
            ],
            []
        ]
    },
    {
        "id": "91d7fb52.d922d8",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{ \"count\": $$.data.new_state.state - $$.data.old_state.state, \"carrier\": \"Amazon\" }",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 960,
        "wires": [
            [
                "ec5c4d8e.e2185"
            ]
        ]
    },
    {
        "id": "5a2b4568.2d2c5c",
        "type": "api-call-service",
        "z": "670bc302.cb732c",
        "name": "Notify HA apps",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": true,
        "service_domain": "notify",
        "service": "all_phone_app",
        "entityId": "",
        "data": "$$.payload.notification",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 240,
        "y": 100,
        "wires": [
            [
                "8495431f.f4f32"
            ]
        ]
    },
    {
        "id": "8495431f.f4f32",
        "type": "api-call-service",
        "z": "670bc302.cb732c",
        "name": "Log",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "$$.payload.log",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": true,
        "x": 450,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "ec5c4d8e.e2185",
        "type": "function",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "func": "return {\n    \"payload\": {\n        \"notification\":\n        {\n            \"title\":\"Mails & Packages\",\n            \"message\":`üì¶ ${msg.payload.count} New package(s) from ${msg.payload.carrier} delivered`,\n            \"data\": {\n                \"tag\":\"package.delivered\",\n                \"priority\":\"high\",\n                \"ttl\":0\n            }\n        },\n        \"log\": {\n            \"name\": msg.payload.carrier,\n            \"entity_id\":\"sensor.mail_usps_mail\",\n            \"message\":\"notified delivered\",\n            \"domain\":\"notify\"\n        }\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 540,
        "y": 840,
        "wires": [
            [
                "601b8ab1.27f8e4"
            ]
        ]
    },
    {
        "id": "cacdd83b.903998",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Home\",\"message\":\"Are you leaving?\",\"data\":{\"tag\":\"tracker.away\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Close garage\",\"action\":\"notification.garage.close\"}]}},\"log\":{\"name\":\"Phone_M (Node Red)\",\"entity_id\":\"device_tracker.phone_m\",\"message\":\"notified leaving home\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 640,
        "wires": [
            [
                "82e5cfd.7e9fd3"
            ]
        ]
    },
    {
        "id": "228dd1fe.a262ce",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Weather\",\"message\":\"‚õÖ It stopped raining\",\"data\":{\"tag\":\"weather.rain.stop\",\"priority\":\"normal\",\"ttl\":0}},\"log\":{\"name\":\"Weather (Node Red)\",\"entity_id\":\"weather.kpvu_hourly\",\"message\":\"notified rain stopped\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 180,
        "wires": [
            [
                "442ab0e0.9b202"
            ]
        ]
    },
    {
        "id": "27015fcf.eaa1e",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Weather\",\"message\":\"üåßÔ∏è It might be raining\",\"data\":{\"tag\":\"weather.rain.start\",\"priority\":\"high\",\"ttl\":0}},\"log\":{\"name\":\"Weather (Node Red)\",\"entity_id\":\"weather.kpvu_hourly\",\"message\":\"notified rain\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 100,
        "wires": [
            [
                "f5b4874.c820978"
            ]
        ]
    },
    {
        "id": "35bc2563.b521fa",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Home\",\"message\":\"Are you home?\",\"data\":{\"tag\":\"tracker.home\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Open garage\",\"action\":\"notification.garage.open\"}]}},\"log\":{\"name\":\"Phone_M (Node Red)\",\"entity_id\":\"device_tracker.phone_m\",\"message\":\"notified getting home\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 560,
        "wires": [
            [
                "221dbd01.cfcc72"
            ]
        ]
    },
    {
        "id": "d46beef9.4f088",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Roborock Vacuum\",\"message\":\"üßπÔ∏è ‚ö†Ô∏è Vacuum in error state\",\"data\":{\"tag\":\"vacuum.error\",\"priority\":\"high\",\"ttl\":0,\"actions\":[{\"title\":\"Find robot\",\"action\":\"notification.vacuum.roborock.find\"}]}},\"log\":{\"name\":\"Roborock (Node Red)\",\"entity_id\":\"vacuum.roborock\",\"message\":\"notified error\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 420,
        "wires": [
            [
                "35e31cc.f48d0e4"
            ]
        ]
    },
    {
        "id": "13ac7cce.77c6e3",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Mails & Packages\",\"message\":\"‚úâÔ∏è New mail(s) coming today (around 1 PM)\",\"data\":{\"tag\":\"mail.coming\"}},\"log\":{\"name\":\"msg.payload\",\"entity_id\":\"sensor.mail_usps_mail\",\"message\":\"notified coming today\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 380,
        "y": 1040,
        "wires": [
            [
                "15739cae.559ee3"
            ]
        ]
    },
    {
        "id": "e6e88d4e.59b0e",
        "type": "change",
        "z": "e2c67c6c.68265",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Trash day\",\"message\":\"üóëDon't forget to take the trash out!\",\"data\":{\"tag\":\"trash.reminder\",\"priority\":\"high\",\"ttl\":0}},\"log\":{\"name\":\"Trash day reminder\",\"message\":\"reminded to take trash out\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 100,
        "wires": [
            [
                "5cad1124.07924"
            ]
        ]
    },
    {
        "id": "e3a8c10d.9e079",
        "type": "change",
        "z": "e2c67c6c.68265",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"After trash day\",\"message\":\"üóëDon't forget to take the trash IN!\",\"data\":{\"tag\":\"trash.reminder\",\"priority\":\"high\",\"ttl\":0}},\"log\":{\"name\":\"Trash day reminder\",\"message\":\"reminded to take trash IN\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 160,
        "wires": [
            [
                "a73fc1db.8105"
            ]
        ]
    },
    {
        "id": "a349aaf7.243f98",
        "type": "change",
        "z": "e2c67c6c.68265",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"notification\":{\"title\":\"Watering\",\"message\":\"üåø Don't forget to water the herbs!\",\"data\":{\"tag\":\"plant.reminder\"}},\"log\":{\"name\":\"Plant watering reminder\",\"message\":\"reminded water plants\",\"domain\":\"notify\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 260,
        "wires": [
            [
                "c1faf23d.8072d"
            ]
        ]
    },
    {
        "id": "38ffe2f9.d41c8e",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "Living Room Light On",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "light.living_room",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 1180,
        "wires": [
            [
                "850099cd.2a80e8"
            ],
            []
        ]
    },
    {
        "id": "850099cd.2a80e8",
        "type": "api-current-state",
        "z": "d9fe96b5.8701c8",
        "name": "TV On",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "media_player.living_room_tv",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 330,
        "y": 1200,
        "wires": [
            [
                "f33e2978.d2d158"
            ],
            []
        ]
    },
    {
        "id": "557be09b.cd1a5",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "TV On",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "media_player.living_room_tv",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 1300,
        "wires": [
            [
                "f33e2978.d2d158"
            ],
            []
        ]
    },
    {
        "id": "f33e2978.d2d158",
        "type": "api-current-state",
        "z": "d9fe96b5.8701c8",
        "name": "After dark? (-1 hour offset)",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.after_dark_offset",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 500,
        "y": 1240,
        "wires": [
            [
                "36b728b3.a353a8"
            ],
            []
        ]
    },
    {
        "id": "d3b259b7.fccef8",
        "type": "api-call-service",
        "z": "d9fe96b5.8701c8",
        "name": "Set brightness",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "light.living_room",
        "data": "$$.payload ? {\t   \"entity_id\":\"light.living_room\",\t   \"brightness_pct\": $$.payload\t} : { \"entity_id\":\"light.living_room\" }",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 640,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "8bf21445.4b9538",
        "type": "comment",
        "z": "d9fe96b5.8701c8",
        "name": "Set dimmer according to sun position & TV state",
        "info": "",
        "x": 220,
        "y": 1120,
        "wires": []
    },
    {
        "id": "36b728b3.a353a8",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "Bightness 40",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "40",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 1300,
        "wires": [
            [
                "d3b259b7.fccef8"
            ]
        ]
    },
    {
        "id": "7c62d47d.ecb98c",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "TV Off",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "media_player.living_room_tv",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 1380,
        "wires": [
            [
                "75fc1d63.768cc4"
            ],
            []
        ]
    },
    {
        "id": "75fc1d63.768cc4",
        "type": "api-current-state",
        "z": "d9fe96b5.8701c8",
        "name": "Living Room Light On",
        "server": "3efaa203.1c443e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.living_room",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 260,
        "y": 1380,
        "wires": [
            [
                "583192e7.17a02c"
            ],
            []
        ]
    },
    {
        "id": "583192e7.17a02c",
        "type": "change",
        "z": "d9fe96b5.8701c8",
        "name": "Brightness 100",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "100",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 1380,
        "wires": [
            [
                "d3b259b7.fccef8"
            ]
        ]
    },
    {
        "id": "e80845f5.8c8a68",
        "type": "server-state-changed",
        "z": "d9fe96b5.8701c8",
        "name": "After dark (-1 hour offset)",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.after_dark_offset",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 1240,
        "wires": [
            [
                "850099cd.2a80e8"
            ],
            []
        ]
    },
    {
        "id": "38735664.29c46a",
        "type": "server-state-changed",
        "z": "9889ef6.6e2771",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "switch.cabinet_light",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 240,
        "y": 320,
        "wires": [
            [
                "6fc54a8c.45b3d4"
            ]
        ]
    },
    {
        "id": "ef9ac3fa.d4873",
        "type": "server-state-changed",
        "z": "9889ef6.6e2771",
        "name": "",
        "server": "3efaa203.1c443e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "switch.hallway_light",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 240,
        "y": 220,
        "wires": [
            [
                "2d5828c1.2bcb68"
            ]
        ]
    },
    {
        "id": "bf7a5591.a95cc8",
        "type": "api-call-service",
        "z": "cfb8073e.876f88",
        "name": "Update state",
        "server": "3efaa203.1c443e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "homeassistant",
        "service": "update_entity",
        "entityId": "",
        "data": "{ \"entity_id\": $env('entity_id') }",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 730,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "2282d523.7b19ca",
        "type": "function",
        "z": "cfb8073e.876f88",
        "name": "Light Toggle",
        "func": "const entity = env.get('entity_id');\nreturn { \n    payload: msg.payload.event.service_data.entity_id === entity && msg.payload.event.domain === 'switch' \n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 210,
        "y": 40,
        "wires": [
            [
                "e944a0e9.8f98b"
            ]
        ]
    },
    {
        "id": "e944a0e9.8f98b",
        "type": "switch",
        "z": "cfb8073e.876f88",
        "name": "true",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 370,
        "y": 40,
        "wires": [
            [
                "e60caf73.30a49"
            ]
        ]
    },
    {
        "id": "e79da058.cfc2f",
        "type": "trigger",
        "z": "cfb8073e.876f88",
        "name": "",
        "op1": "",
        "op2": "0",
        "op1type": "pay",
        "op2type": "str",
        "duration": "-50",
        "extend": false,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 470,
        "y": 320,
        "wires": [
            [
                "bf7a5591.a95cc8",
                "18d7822a.92842e"
            ]
        ]
    },
    {
        "id": "1241bdd8.2da8c2",
        "type": "change",
        "z": "cfb8073e.876f88",
        "name": "Reset",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 130,
        "y": 520,
        "wires": [
            [
                "18d7822a.92842e",
                "46f4751b.1d84fc"
            ]
        ]
    },
    {
        "id": "18d7822a.92842e",
        "type": "counter",
        "z": "cfb8073e.876f88",
        "name": "",
        "init": "0",
        "step": "1",
        "lower": "",
        "upper": "",
        "mode": "increment",
        "outputs": "1",
        "x": 600,
        "y": 520,
        "wires": [
            [
                "48443e86.5bc42"
            ]
        ]
    },
    {
        "id": "48443e86.5bc42",
        "type": "switch",
        "z": "cfb8073e.876f88",
        "name": ">10",
        "property": "count",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "10",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 750,
        "y": 520,
        "wires": [
            [
                "1241bdd8.2da8c2"
            ]
        ]
    },
    {
        "id": "f4c630e6.7fcef",
        "type": "subflow:cfb8073e.876f88",
        "z": "9889ef6.6e2771",
        "name": "Update light state",
        "env": [],
        "x": 480,
        "y": 640,
        "wires": []
    },
    {
        "id": "b62cc54a.e92368",
        "type": "function",
        "z": "cfb8073e.876f88",
        "name": "Input handler",
        "func": "if (msg.topic === 'service') {\n    return [msg, null];\n}\n\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 130,
        "y": 140,
        "wires": [
            [
                "2282d523.7b19ca"
            ],
            [
                "1241bdd8.2da8c2"
            ]
        ]
    },
    {
        "id": "46f4751b.1d84fc",
        "type": "switch",
        "z": "cfb8073e.876f88",
        "name": "",
        "property": "interval",
        "propertyType": "env",
        "rules": [
            {
                "t": "eq",
                "v": "50",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "125",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 310,
        "y": 340,
        "wires": [
            [
                "e79da058.cfc2f"
            ],
            [
                "878b8c84.67094"
            ]
        ]
    },
    {
        "id": "878b8c84.67094",
        "type": "trigger",
        "z": "cfb8073e.876f88",
        "name": "",
        "op1": "",
        "op2": "0",
        "op1type": "pay",
        "op2type": "str",
        "duration": "-125",
        "extend": false,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 480,
        "y": 360,
        "wires": [
            [
                "18d7822a.92842e",
                "bf7a5591.a95cc8"
            ]
        ]
    },
    {
        "id": "9d0384ee.324008",
        "type": "delay",
        "z": "cfb8073e.876f88",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 470,
        "y": 180,
        "wires": [
            [
                "46f4751b.1d84fc"
            ]
        ]
    },
    {
        "id": "e60caf73.30a49",
        "type": "switch",
        "z": "cfb8073e.876f88",
        "name": "",
        "property": "delay",
        "propertyType": "env",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "50",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "100",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 310,
        "y": 180,
        "wires": [
            [
                "9ccfb807.631b88"
            ],
            [
                "9d0384ee.324008"
            ],
            [
                "893055ff.24d938"
            ]
        ]
    },
    {
        "id": "893055ff.24d938",
        "type": "delay",
        "z": "cfb8073e.876f88",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 470,
        "y": 220,
        "wires": [
            [
                "46f4751b.1d84fc"
            ]
        ]
    },
    {
        "id": "9ccfb807.631b88",
        "type": "delay",
        "z": "cfb8073e.876f88",
        "name": "",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 470,
        "y": 140,
        "wires": [
            [
                "46f4751b.1d84fc"
            ]
        ]
    },
    {
        "id": "2d5828c1.2bcb68",
        "type": "subflow:cfb8073e.876f88",
        "z": "9889ef6.6e2771",
        "name": "Hallway Light",
        "env": [
            {
                "name": "entity_id",
                "value": "switch.hallway_light",
                "type": "str"
            },
            {
                "name": "interval",
                "value": "125",
                "type": "num"
            },
            {
                "name": "delay",
                "value": "100",
                "type": "num"
            }
        ],
        "x": 530,
        "y": 200,
        "wires": []
    },
    {
        "id": "61d5e76f.eaa9d8",
        "type": "change",
        "z": "9889ef6.6e2771",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "service",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 180,
        "wires": [
            [
                "2d5828c1.2bcb68"
            ]
        ]
    },
    {
        "id": "6fc54a8c.45b3d4",
        "type": "subflow:cfb8073e.876f88",
        "z": "9889ef6.6e2771",
        "name": "Cabinet Light",
        "env": [
            {
                "name": "entity_id",
                "value": "switch.cabinet_light",
                "type": "str"
            },
            {
                "name": "delay",
                "value": "100",
                "type": "num"
            }
        ],
        "x": 530,
        "y": 300,
        "wires": []
    },
    {
        "id": "901be019.50f94",
        "type": "change",
        "z": "9889ef6.6e2771",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "service",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 280,
        "wires": [
            [
                "6fc54a8c.45b3d4"
            ]
        ]
    }
]